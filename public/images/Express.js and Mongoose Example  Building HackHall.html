<!DOCTYPE html>
<!-- saved from url=(0071)http://webapplog.com/express-js-and-mongoose-example-building-hackhall/ -->
<html lang="en-US"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>Express.js and Mongoose Example: Building HackHall</title>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="http://webapplog.com/xmlrpc.php">
<!--[if lt IE 9]>
<script src="http://webapplog.com/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->

<!-- BEGIN Metadata added by Add-Meta-Tags WordPress plugin -->
<meta name="description" content="Note: This text is a part of the Express.js Guide: The Comprehensive Book on Express.js. The HackHall project was written using Backbone.js and Underscore for the front-end app, and Express.js, MongoDB via Mongoose for the back-end REST API server. Example: The HackHall source code is in the public &lt;a href=http://github.">
<meta name="keywords" content="node, node.js, express.js, javascript, rapid prototyping, rapid prototyping with js, book, mongodb, node.js, startups, tutorials, express.js, expressjs, hackhall, mongodb, node.js, rest api">
<!-- END Metadata added by Add-Meta-Tags WordPress plugin -->

<link rel="alternate" type="application/rss+xml" title="webapplog: [programming weblog] » Feed" href="http://webapplog.com/feed/">
<link rel="alternate" type="application/rss+xml" title="webapplog: [programming weblog] » Comments Feed" href="http://webapplog.com/comments/feed/">

            <script src="./Express.js and Mongoose Example  Building HackHall_files/cb=gapi.loaded_1" async=""></script><script async="" type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/mlt.js"></script><script src="./Express.js and Mongoose Example  Building HackHall_files/cb=gapi.loaded_0" async=""></script><script type="text/javascript" async="" src="./Express.js and Mongoose Example  Building HackHall_files/widgets.js"></script><script type="text/javascript" async="" src="./Express.js and Mongoose Example  Building HackHall_files/ga.js"></script><script type="text/javascript" async="" src="./Express.js and Mongoose Example  Building HackHall_files/ga.js"></script><script type="text/javascript">//<![CDATA[
            // Google Analytics for WordPress by Yoast v4.3.5 | http://yoast.com/wordpress/google-analytics/
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-31400044-1']);
				            _gaq.push(['_trackPageview']);
            (function () {
                var ga = document.createElement('script');
                ga.type = 'text/javascript';
                ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';

                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(ga, s);
            })();
            //]]></script>
			<link rel="alternate" type="application/rss+xml" title="webapplog: [programming weblog] » Express.js and Mongoose Example: Building HackHall Comments Feed" href="http://webapplog.com/express-js-and-mongoose-example-building-hackhall/feed/">
<link rel="stylesheet" id="mailchimpSF_main_css-css" href="./Express.js and Mongoose Example  Building HackHall_files/saved_resource" type="text/css" media="all">
<!--[if IE]>
<link rel='stylesheet' id='mailchimpSF_ie_css-css'  href='http://webapplog.com/wp-content/plugins/mailchimp/css/ie.css?ver=3.8.1' type='text/css' media='all' />
<![endif]-->
<link rel="stylesheet" id="contact-form-7-css" href="./Express.js and Mongoose Example  Building HackHall_files/styles.css" type="text/css" media="all">
<link rel="stylesheet" id="digg-digg-css" href="./Express.js and Mongoose Example  Building HackHall_files/diggdigg-style.css" type="text/css" media="screen">
<link rel="stylesheet" id="stacktack-css" href="./Express.js and Mongoose Example  Building HackHall_files/stacktack.min.css" type="text/css" media="all">
<link rel="stylesheet" id="seed-wnb-css-css" href="./Express.js and Mongoose Example  Building HackHall_files/seed_wnb.css" type="text/css" media="all">
<link rel="stylesheet" id="twentytwelve-fonts-css" href="./Express.js and Mongoose Example  Building HackHall_files/css" type="text/css" media="all">
<link rel="stylesheet" id="twentytwelve-style-css" href="./Express.js and Mongoose Example  Building HackHall_files/style.css" type="text/css" media="all">
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='http://webapplog.com/wp-content/themes/twentytwelve/css/ie.css?ver=20121010' type='text/css' media='all' />
<![endif]-->
<link rel="stylesheet" id="multilevelnav_style-css" href="./Express.js and Mongoose Example  Building HackHall_files/saved_resource(1)" type="text/css" media="all">
<script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/jquery.js"></script>
<script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/jquery-migrate.min.js"></script>
<script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/scrollTo.js"></script>
<script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/jquery.form.min.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var mailchimpSF = {"ajax_url":"http:\/\/webapplog.com\/"};
/* ]]> */
</script>
<script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/mailchimp.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var seed_wnb_js_localize = {"msg":"Goodbye Express.js Guide Sale: 4 Books For Only $19.99 (reg. $84.97)","button_link":"https:\/\/leanpub.com\/b\/goodbyeexpressjsguide?utm_source=wal_bar_learnmore","button_label":"LEARN MORE","button_target":"_blank"};
/* ]]> */
</script>
<script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/seed_wnb.js"></script>
<script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/wnb-webapplog.js"></script>
<script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/superfish.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://webapplog.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://webapplog.com/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Q&amp;A: ImageMagick and Code Organization in Express.js" href="http://webapplog.com/qa-imagemagick-and-code-organization-in-express-js/">
<link rel="next" title="Emoji in GitHub Commit Messages" href="http://webapplog.com/emoji-in-github-commit-messages/">
<link rel="shortlink" href="http://webapplog.com/?p=1297">

<!-- metadata inserted by keyword-statistics-plugin 1.7.8 http://www.keyword-statistics.net -->
<meta name="robots" content="noodp,noarchive,noydir">
<link rel="canonical" href="./Express.js and Mongoose Example  Building HackHall_files/Express.js and Mongoose Example  Building HackHall.html">
<!-- end of metadata -->

<!-- Multi-level Navigation Plugin v2.3.6 by Ryan Hellyer ... http://geek.ryanhellyer.net/multi-level-navigation/ -->
<!--[if lte IE 7]><script type="text/javascript" src="http://webapplog.com/wp-content/plugins/multi-level-navigation-plugin/scripts/suckerfish_ie.js"></script><![endif]--><script>jQuery(document).ready(function() {
	jQuery("ul.sf-menu").superfish({
		animation:     {opacity:"show",height:"show"},  // fade-in and slide-down animation
		delay:        0,                            // delay on mouseout
		speed:        "fast",  // animation speed
		autoArrows:   "",  // enable generation of arrow mark-up
		dropShadows:  ""  // enable drop shadows
	});
});
/**
* hoverIntent is similar to jQuery's built-in "hover" function except that
* instead of firing the onMouseOver event immediately, hoverIntent checks
* to see if the user's mouse has slowed down (beneath the sensitivity
* threshold) before firing the onMouseOver event.
*
* hoverIntent r5 // 2007.03.27 // jQuery 1.1.2+
* <http://cherne.net/brian/resources/jquery.hoverIntent.html>
*
* hoverIntent is currently available for use in all personal or commercial
* projects under both MIT and GPL licenses. This means that you can choose
* the license that best suits your project, and use it accordingly.
*
* // basic usage (just like .hover) receives onMouseOver and onMouseOut functions
* $("ul li").hoverIntent( showNav , hideNav );
*
* // advanced usage receives configuration object only
* $("ul li").hoverIntent({
*	sensitivity: 7, // number = sensitivity threshold (must be 1 or higher)
*	interval: 100,   // number = milliseconds of polling interval
*	over: showNav,  // function = onMouseOver callback (required)
*	timeout: 0,   // number = milliseconds delay before onMouseOut function call
*	out: hideNav    // function = onMouseOut callback (required)
* });
*
* @param  f  onMouseOver function || An object with configuration options
* @param  g  onMouseOut function  || Nothing (use configuration options object)
* @author    Brian Cherne <brian@cherne.net>
*/
(function($) {
	$.fn.hoverIntent = function(f,g) {
		// default configuration options
		var cfg = {
			sensitivity: 10,
			interval: 200,
			timeout: 0
		};
		// override configuration options with user supplied object
		cfg = $.extend(cfg, g ? { over: f, out: g } : f );

		// instantiate variables
		// cX, cY = current X and Y position of mouse, updated by mousemove event
		// pX, pY = previous X and Y position of mouse, set by mouseover and polling interval
		var cX, cY, pX, pY;

		// A private function for getting mouse position
		var track = function(ev) {
			cX = ev.pageX;
			cY = ev.pageY;
		};

		// A private function for comparing current and previous mouse position
		var compare = function(ev,ob) {
			ob.hoverIntent_t = clearTimeout(ob.hoverIntent_t);
			// compare mouse positions to see if they've crossed the threshold
			if ( ( Math.abs(pX-cX) + Math.abs(pY-cY) ) < cfg.sensitivity ) {
				$(ob).unbind("mousemove",track);
				// set hoverIntent state to true (so mouseOut can be called)
				ob.hoverIntent_s = 1;
				return cfg.over.apply(ob,[ev]);
			} else {
				// set previous coordinates for next time
				pX = cX; pY = cY;
				// use self-calling timeout, guarantees intervals are spaced out properly (avoids JavaScript timer bugs)
				ob.hoverIntent_t = setTimeout( function(){compare(ev, ob);} , cfg.interval );
			}
		};

		// A private function for delaying the mouseOut function
		var delay = function(ev,ob) {
			ob.hoverIntent_t = clearTimeout(ob.hoverIntent_t);
			ob.hoverIntent_s = 0;
			return cfg.out.apply(ob,[ev]);
		};

		// A private function for handling mouse 'hovering'
		var handleHover = function(e) {
			// next three lines copied from jQuery.hover, ignore children onMouseOver/onMouseOut
			var p = (e.type == "mouseover" ? e.fromElement : e.toElement) || e.relatedTarget;
			while ( p && p != this ) { try { p = p.parentNode; } catch(e) { p = this; } }
			if ( p == this ) { return false; }

			// copy objects to be passed into t (required for event object to be passed in IE)
			var ev = jQuery.extend({},e);
			var ob = this;

			// cancel hoverIntent timer if it exists
			if (ob.hoverIntent_t) { ob.hoverIntent_t = clearTimeout(ob.hoverIntent_t); }

			// else e.type == "onmouseover"
			if (e.type == "mouseover") {
				// set "previous" X and Y position based on initial entry point
				pX = ev.pageX; pY = ev.pageY;
				// update "current" X and Y position based on mousemove
				$(ob).bind("mousemove",track);
				// start polling interval (self-calling timeout) to compare mouse coordinates over time
				if (ob.hoverIntent_s != 1) { ob.hoverIntent_t = setTimeout( function(){compare(ev,ob);} , cfg.interval );}

			// else e.type == "onmouseout"
			} else {
				// unbind expensive mousemove event
				$(ob).unbind("mousemove",track);
				// if hoverIntent state is true, then call the mouseOut function after the specified delay
				if (ob.hoverIntent_s == 1) { ob.hoverIntent_t = setTimeout( function(){delay(ev,ob);} , cfg.timeout );}
			}
		};

		// bind the function to the two event listeners
		return this.mouseover(handleHover).mouseout(handleHover);
	};
})(jQuery);
</script><style type="text/css">#bg_color { color:black; }
.wnb-bar-button {
  color:white;
  text-shadow:0 -1px 0 rgba(0,0,0,0.25);
  background-color:black;
}
#wnb-bar {
  color:black;
  position:fixed;
  background-color:#71b1db;
  background-image:-moz-linear-gradient(top,#71b1db,#55a1d4);
  background-image:-ms-linear-gradient(top,#71b1db,#55a1d4);
  background-image:-webkit-gradient(linear,0 0,0 100%,from(#71b1db),to(#55a1d4));
  background-image:-webkit-linear-gradient(top,#71b1db,#55a1d4);
  background-image:-o-linear-gradient(top,#71b1db,#55a1d4);
  background-image:linear-gradient(top,#71b1db,#55a1d4);
  background-repeat:repeat-x;
  filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#71b1db',endColorstr='#55a1d4',GradientType=0);
}
</style>    <script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/highlight.pack.js"></script>
    <script type="text/javascript">hljs.initHighlightingOnLoad();</script>
    <link rel="stylesheet" href="http://webapplog.com/wp-content/plugins/wp-highlightjs/styles/zenburn.css">
    <style>pre.hljs {padding: 0px;}
pre.hljs code {border: 1px solid #ccc; padding: 5px;}
code{
-moz-border-radius: 10px;
border-radius: 10px;}
</style>

<!-- All in One SEO Pack 2.1.3 by Michael Torbert of Semper Fi Web Design[300,391] -->
<link rel="author" href="https://plus.google.com/116816240985852388027/about">
<meta name="keywords" content="express.js, expressjs, node.js, nodejs, mongodb,expressjs,hackhall,mongodb,node.js,rest api,book,startups,tutorials">

<link rel="canonical" href="./Express.js and Mongoose Example  Building HackHall_files/Express.js and Mongoose Example  Building HackHall.html">
		<script type="text/javascript">
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-31400044-1']);
		  _gaq.push(['_trackPageview']);
		  (function() {
		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();
		</script>
		<script type="text/javascript">
		function recordOutboundLink(link, category, action) {
					_gat._getTrackerByName()._trackEvent(category, action);
					if ( link.target == '_blank' ) return true;
			setTimeout('document.location = "' + link.href + '"', 100);
			return false;
		}
			/* use regular Javascript for this */
			function getAttr(ele, attr) {
				var result = (ele.getAttribute && ele.getAttribute(attr)) || null;
				if( !result ) {
					var attrs = ele.attributes;
					var length = attrs.length;
					for(var i = 0; i < length; i++)
					if(attr[i].nodeName === attr) result = attr[i].nodeValue;
				}
				return result;
			}
			function aiosp_addLoadEvent(func) {
			  var oldonload = window.onload;
			  if (typeof window.onload != 'function') {
			    window.onload = func;
			  } else {
			    window.onload = function() {
			      if (oldonload) {
			        oldonload();
			      }
			      func();
			    }
			  }
			}

			aiosp_addLoadEvent(function () {
				var links = document.getElementsByTagName('a');
				for (var x=0; x < links.length; x++) {
					if (typeof links[x] == 'undefined') continue;
					if (typeof links[x].onclick != 'undefined') continue;
					links[x].onclick = function () {
						var mydomain = new RegExp(document.domain, 'i');
						href = getAttr(this, 'href');
						if(href && href.toLowerCase().indexOf('http') === 0 && !mydomain.test(href)) {
							recordOutboundLink(this, 'Outbound Links', href);
						}
					}
				}
			});
		</script>
<!-- /all in one seo pack -->
	<style type="text/css" id="twentytwelve-header-css">
			.site-header h1 a,
		.site-header h2 {
			color: #0a0a0a;
		}
		</style>
	<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #ffffff; }
</style>
<script src="./Express.js and Mongoose Example  Building HackHall_files/nonSecureAnonymousFramework"></script><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}.fb_link img{border:none}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_reset .fb_dialog_legacy{overflow:visible}.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}.fb_dialog_content{background:#fff;color:#333}.fb_dialog_close_icon{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}.fb_dialog_close_icon:active{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}.fb_dialog_loader{background-color:#f2f2f2;border:1px solid #606060;font-size:24px;padding:20px}.fb_dialog_top_left,.fb_dialog_top_right,.fb_dialog_bottom_left,.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}.fb_dialog_top_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}.fb_dialog_top_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}.fb_dialog_bottom_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}.fb_dialog_bottom_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}.fb_dialog_vert_left,.fb_dialog_vert_right,.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}.fb_dialog_vert_left,.fb_dialog_vert_right{width:10px;height:100%}.fb_dialog_vert_left{margin-left:-10px}.fb_dialog_vert_right{right:0;margin-right:-10px}.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{width:100%;height:10px}.fb_dialog_horiz_top{margin-top:-10px}.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3b5998;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{-webkit-transform:none;height:100%;margin:0;overflow:visible;position:absolute;top:-10000px;left:0;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{max-height:590px;min-height:590px;max-width:500px;min-width:500px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;left:0;top:0;width:100%;min-height:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#4966A6), color-stop(.5, #355492), to(#2A4887));border:1px solid #29447e;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset, rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f2f2f2;border:1px solid #555;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_lift{z-index:1}.fb_hide_iframes iframe{position:relative;left:-10000px}.fb_iframe_widget_loader{position:relative;display:inline-block}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}.fb_iframe_widget_loader .FB_Loader{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}
.fb_connect_bar_container div,.fb_connect_bar_container span,.fb_connect_bar_container a,.fb_connect_bar_container img,.fb_connect_bar_container strong{background:none;border-spacing:0;border:0;direction:ltr;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal;vertical-align:baseline}.fb_connect_bar_container{position:fixed;left:0 !important;right:0 !important;height:42px !important;padding:0 25px !important;margin:0 !important;vertical-align:middle !important;border-bottom:1px solid #333 !important;background:#3b5998 !important;z-index:99999999 !important;overflow:hidden !important}.fb_connect_bar_container_ie6{position:absolute;top:expression(document.compatMode=="CSS1Compat"? document.documentElement.scrollTop+"px":body.scrollTop+"px")}.fb_connect_bar{position:relative;margin:auto;height:100%;width:100%;padding:6px 0 0 0 !important;background:none;color:#fff !important;font-family:"lucida grande", tahoma, verdana, arial, sans-serif !important;font-size:13px !important;font-style:normal !important;font-variant:normal !important;font-weight:normal !important;letter-spacing:normal !important;line-height:1 !important;text-decoration:none !important;text-indent:0 !important;text-shadow:none !important;text-transform:none !important;white-space:normal !important;word-spacing:normal !important}.fb_connect_bar a:hover{color:#fff}.fb_connect_bar .fb_profile img{height:30px;width:30px;vertical-align:middle;margin:0 6px 5px 0}.fb_connect_bar div a,.fb_connect_bar span,.fb_connect_bar span a{color:#bac6da;font-size:11px;text-decoration:none}.fb_connect_bar .fb_buttons{float:right;margin-top:7px}
.fbpluginrecommendationsbarleft,.fbpluginrecommendationsbarright{position:fixed !important;bottom:0;z-index:999}.fbpluginrecommendationsbarleft{left:10px}.fbpluginrecommendationsbarright{right:10px}</style><style type="text/css">* html #li_ui_li_gen_1396743077000_0 a#li_ui_li_gen_1396743077000_0-link{height:1% !important;}#li_ui_li_gen_1396743077000_0{position:relative !important;overflow:visible !important;display:block !important;}#li_ui_li_gen_1396743077000_0 a#li_ui_li_gen_1396743077000_0-link{border:0 !important;height:20px !important;text-decoration:none !important;padding:0 !important;margin:0 !important;display:inline-block !important;}#li_ui_li_gen_1396743077000_0 a#li_ui_li_gen_1396743077000_0-link:link, #li_ui_li_gen_1396743077000_0 a#li_ui_li_gen_1396743077000_0-link:visited, #li_ui_li_gen_1396743077000_0 a#li_ui_li_gen_1396743077000_0-link:hover, #li_ui_li_gen_1396743077000_0 a#li_ui_li_gen_1396743077000_0-link:active{border:0 !important;text-decoration:none !important;}#li_ui_li_gen_1396743077000_0 a#li_ui_li_gen_1396743077000_0-link:after{content:"." !important;display:block !important;clear:both !important;visibility:hidden !important;line-height:0 !important;height:0 !important;}#li_ui_li_gen_1396743077000_0 #li_ui_li_gen_1396743077000_0-logo{background-image:url(http://s.c.lnkd.licdn.com/scds/common/u/images/apps/connect/sprites/sprite_connect_v14.png) !important;background-position:0px -276px !important;background-repeat:no-repeat !important;background-size:initial !important;cursor:pointer !important;border:0 !important;text-indent:-9999em !important;overflow:hidden !important;padding:0 !important;margin:0 !important;position:absolute !important;left:0px !important;top:0px !important;display:block !important;width:20px !important;height:20px !important;float:right !important;border-radius:0 !important;-webkit-border-radius:0 !important;border-top-right-radius:2px !important;border-bottom-right-radius:2px !important;-webkit-border-top-right-radius:2px !important;-webkit-border-bottom-right-radius:2px !important;}#li_ui_li_gen_1396743077000_0.hovered #li_ui_li_gen_1396743077000_0-logo{background-position:-20px -276px !important;}#li_ui_li_gen_1396743077000_0.clicked #li_ui_li_gen_1396743077000_0-logo, #li_ui_li_gen_1396743077000_0.down #li_ui_li_gen_1396743077000_0-logo{background-position:-40px -276px !important;}.IN-shadowed #li_ui_li_gen_1396743077000_0 #li_ui_li_gen_1396743077000_0-logo{}#li_ui_li_gen_1396743077000_0 #li_ui_li_gen_1396743077000_0-title{color:#333 !important;cursor:pointer !important;display:block !important;white-space:nowrap !important;float:left !important;margin-left:1px !important;vertical-align:top !important;overflow:hidden !important;text-align:center !important;height:18px !important;padding:0 4px 0 23px !important;border:1px solid #000 !important;border-top-color:#E2E2E2 !important;border-right-color:#BFBFBF !important;border-bottom-color:#B9B9B9 !important;border-left-color:#E2E2E2 !important;border-left:0 !important;text-shadow:#FFFFFF -1px 1px 0 !important;line-height:20px !important;border-radius:0 !important;-webkit-border-radius:0 !important;border-top-right-radius:2px !important;border-bottom-right-radius:2px !important;-webkit-border-top-right-radius:2px !important;-webkit-border-bottom-right-radius:2px !important;background-color:#ECECEC !important;background-image:-webkit-gradient(linear, left top, left bottom, color-stop(0%,#FEFEFE), color-stop(100%,#ECECEC)) !important; background-image: -webkit-linear-gradient(top, #FEFEFE 0%, #ECECEC 100%) !important;}#li_ui_li_gen_1396743077000_0.hovered #li_ui_li_gen_1396743077000_0-title{border:1px solid #000 !important;border-top-color:#ABABAB !important;border-right-color:#9A9A9A !important;border-bottom-color:#787878 !important;border-left-color:#04568B !important;border-left:0 !important;background-color:#EDEDED !important;background-image:-webkit-gradient(linear, left top, left bottom, color-stop(0%,#EDEDED), color-stop(100%,#DEDEDE)) !important; background-image: -webkit-linear-gradient(top, #EDEDED 0%, #DEDEDE 100%) !important;}#li_ui_li_gen_1396743077000_0.clicked #li_ui_li_gen_1396743077000_0-title, #li_ui_li_gen_1396743077000_0.down #li_ui_li_gen_1396743077000_0-title{color:#666 !important;border:1px solid #000 !important;border-top-color:#B6B6B6 !important;border-right-color:#B3B3B3 !important;border-bottom-color:#9D9D9D !important;border-left-color:#49627B !important;border-left:0 !important;background-color:#DEDEDE !important;background-image:-webkit-gradient(linear, left top, left bottom, color-stop(0%,#E3E3E3), color-stop(100%,#EDEDED)) !important; background-image: -webkit-linear-gradient(top, #E3E3E3 0%, #EDEDED 100%) !important;}.IN-shadowed #li_ui_li_gen_1396743077000_0 #li_ui_li_gen_1396743077000_0-title{}.IN-shadowed #li_ui_li_gen_1396743077000_0.hovered #li_ui_li_gen_1396743077000_0-title{}.IN-shadowed #li_ui_li_gen_1396743077000_0.clicked #li_ui_li_gen_1396743077000_0-title, .IN-shadowed #li_ui_li_gen_1396743077000_0.down #li_ui_li_gen_1396743077000_0-title{}#li_ui_li_gen_1396743077000_0 #li_ui_li_gen_1396743077000_0-title-text, #li_ui_li_gen_1396743077000_0 #li_ui_li_gen_1396743077000_0-title-text *{color:#333 !important;font-size:11px !important;font-family:Arial, sans-serif !important;font-weight:bold !important;font-style:normal !important;-webkit-font-smoothing:antialiased !important;display:inline-block !important;background:transparent none !important;vertical-align:top !important;height:18px !important;line-height:20px !important;float:none !important;}#li_ui_li_gen_1396743077000_0 #li_ui_li_gen_1396743077000_0-title-text strong{font-weight:bold !important;}#li_ui_li_gen_1396743077000_0 #li_ui_li_gen_1396743077000_0-title-text em{font-style:italic !important;}#li_ui_li_gen_1396743077000_0.hovered #li_ui_li_gen_1396743077000_0-title-text, #li_ui_li_gen_1396743077000_0.hovered #li_ui_li_gen_1396743077000_0-title-text *{color:#000 !important;}#li_ui_li_gen_1396743077000_0.clicked #li_ui_li_gen_1396743077000_0-title-text, #li_ui_li_gen_1396743077000_0.down #li_ui_li_gen_1396743077000_0-title-text, #li_ui_li_gen_1396743077000_0.clicked #li_ui_li_gen_1396743077000_0-title-text *, #li_ui_li_gen_1396743077000_0.down #li_ui_li_gen_1396743077000_0-title-text *{color:#666 !important;}#li_ui_li_gen_1396743077000_0 #li_ui_li_gen_1396743077000_0-title #li_ui_li_gen_1396743077000_0-mark{display:inline-block !important;width:0px !important;overflow:hidden !important;}.success #li_ui_li_gen_1396743077000_0 #li_ui_li_gen_1396743077000_0-title{color:#333 !important;border-top-color:#E2E2E2 !important;border-right-color:#BFBFBF !important;border-bottom-color:#B9B9B9 !important;border-left-color:#E2E2E2 !important;background-color:#ECECEC !important;background-image:-webkit-gradient(linear, left top, left bottom, color-stop(0%,#FEFEFE), color-stop(100%,#ECECEC)) !important; background-image: -webkit-linear-gradient(top, #FEFEFE 0%, #ECECEC 100%) !important;}.success #li_ui_li_gen_1396743077000_0 #li_ui_li_gen_1396743077000_0-title-text, .success #li_ui_li_gen_1396743077000_0 #li_ui_li_gen_1396743077000_0-title-text *{color:#333 !important;}.IN-shadowed .success #li_ui_li_gen_1396743077000_0 #li_ui_li_gen_1396743077000_0-title{}.success #li_ui_li_gen_1396743077000_0.hovered #li_ui_li_gen_1396743077000_0-title{color:#000 !important;border-top-color:#ABABAB !important;border-right-color:#9A9A9A !important;border-bottom-color:#787878 !important;border-left-color:#04568B !important;background-color:#EDEDED !important;background-image:-webkit-gradient(linear, left top, left bottom, color-stop(0%,#EDEDED), color-stop(100%,#DEDEDE)) !important; background-image: -webkit-linear-gradient(top, #EDEDED 0%, #DEDEDE 100%) !important;}.success #li_ui_li_gen_1396743077000_0.hovered #li_ui_li_gen_1396743077000_0-title-text, .success #li_ui_li_gen_1396743077000_0.hovered #li_ui_li_gen_1396743077000_0-title-text *{color:#000 !important;}.success #li_ui_li_gen_1396743077000_0.clicked #li_ui_li_gen_1396743077000_0-title, .success #li_ui_li_gen_1396743077000_0.down #li_ui_li_gen_1396743077000_0-title{color:#666 !important;border-top-color:#B6B6B6 !important;border-right-color:#B3B3B3 !important;border-bottom-color:#9D9D9D !important;border-left-color:#49627B !important;background-color:#DEDEDE !important;background-image:-webkit-gradient(linear, left top, left bottom, color-stop(0%,#E3E3E3), color-stop(100%,#EDEDED)) !important; background-image: -webkit-linear-gradient(top, #E3E3E3 0%, #EDEDED 100%) !important;}.success #li_ui_li_gen_1396743077000_0.clicked #li_ui_li_gen_1396743077000_0-title-text, .success #li_ui_li_gen_1396743077000_0.down #li_ui_li_gen_1396743077000_0-title-text, .success #li_ui_li_gen_1396743077000_0.clicked #li_ui_li_gen_1396743077000_0-title-text *, .success #li_ui_li_gen_1396743077000_0.down #li_ui_li_gen_1396743077000_0-title-text *{color:#666 !important;}.IN-shadowed .success #li_ui_li_gen_1396743077000_0.clicked #li_ui_li_gen_1396743077000_0-title, .IN-shadowed .success #li_ui_li_gen_1396743077000_0.down #li_ui_li_gen_1396743077000_0-title{}#li_ui_li_gen_1396743077009_1-container.IN-top {display:inline-block !important;overflow:visible !important;position:relative !important;height:42px !important;line-height:1px !important;cursor:pointer !important;}#li_ui_li_gen_1396743077009_1.IN-top {display:inline-block !important;height:42px !important;width:57px !important;text-align:center !important;background-image:url(http://s.c.lnkd.licdn.com/scds/common/u/images/apps/connect/sprites/sprite_connect_v14.png) !important;background-color:transparent !important;background-repeat:no-repeat !important;background-position:-150px top !important;}#li_ui_li_gen_1396743077009_1-content.IN-top {display:inline !important;font-size:16px !important;color:#04558B !important;font-weight:bold !important;font-family:Arial, sans-serif !important;line-height:38px !important;}#li_ui_li_gen_1396743077009_1-container.IN-empty #li_ui_li_gen_1396743077009_1-inner.IN-top {background-image:url(http://s.c.lnkd.licdn.com/scds/common/u/images/apps/connect/sprites/sprite_connect_v14.png) !important;background-color:transparent !important;background-repeat:no-repeat !important;background-position:0px -20px !important;overflow:hidden !important;margin:5px auto 0 auto !important;width:26px !important;height:26px !important;display:block !important;}#li_ui_li_gen_1396743077009_1-container.IN-empty #li_ui_li_gen_1396743077009_1-content.IN-top {text-indent:-999px !important;display:inline-block !important;}#li_ui_li_gen_1396743077009_1-container.IN-hidden #li_ui_li_gen_1396743077009_1 {display:none !important;}</style></head>

<body class="single single-post postid-1297 single-format-standard custom-background custom-background-white custom-font-enabled single-author" data-twttr-rendered="true" style="padding-top: 33px;"><div id="wnb-bar" style="cursor: pointer;"><span>Goodbye Express.js Guide Sale: 4 Books For Only $19.99 (reg. $84.97)</span> <a href="https://leanpub.com/b/goodbyeexpressjsguide?utm_source=wal_bar_learnmore" target="_blank"><span class="wnb-bar-button">LEARN MORE</span></a><span class="wnb-close-button" style="height: 30px; width: 28px; display: block; outline: none; border: none; margin: 0px auto; cursor: pointer; position: absolute; top: 0px; right: 5px; background-image: url(http://webapplog.com/wp-content/themes/2012-webapplog/img/x-white.png); background-position: 0px 50%; background-repeat: no-repeat no-repeat;"></span></div>
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
					<a href="http://webapplog.com/"><img src="./Express.js and Mongoose Example  Building HackHall_files/webapplog-logo-pink2-50.png" class="header-image" width="50" height="50" alt=""></a>
		
		<hgroup>
			<h1 class="site-title"><a href="http://webapplog.com/" title="webapplog: [programming weblog]" rel="home">webapplog: [programming weblog]</a></h1>
			<h2 class="site-description">Software engineering, Node.js, JavaScript and startups.</h2>
		</hgroup>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<h3 class="menu-toggle">Menu</h3>
			<a class="assistive-text" href="http://webapplog.com/express-js-and-mongoose-example-building-hackhall/#content" title="Skip to content">Skip to content</a>
			<div class="menu-main-menu-container"><ul id="menu-main-menu" class="nav-menu"><li id="menu-item-535" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-535"><a href="http://www.webapplog.com/">Posts</a></li>
<li id="menu-item-319" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-319"><a title="About Azat" href="http://webapplog.com/about-azat-mardanov/">About Azat</a></li>
<li id="menu-item-533" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-533"><a title="Trainings" href="http://webapplog.com/trainings/">Trainings</a></li>
<li id="menu-item-524" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-524"><a href="http://webapplog.com/books/">Books</a></li>
<li id="menu-item-516" class="rss menu-item menu-item-type-custom menu-item-object-custom menu-item-516"><a title="RSS" href="http://webapplog.com/feed">RSS</a></li>
<li id="menu-item-518" class="twitter menu-item menu-item-type-custom menu-item-object-custom menu-item-518"><a title="Twitter" href="http://twitter.com/azat_co" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-menu&#39;,&#39;http://twitter.com&#39;]);">Twitter</a></li>
<li id="menu-item-519" class="facebook menu-item menu-item-type-custom menu-item-object-custom menu-item-519"><a title="Facebook" href="http://facebook.com/azat.mardanov" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-menu&#39;,&#39;http://facebook.com&#39;]);">Facebook</a></li>
</ul></div>		</nav><!-- #site-navigation -->


	</header><!-- #masthead -->

	<div id="main" class="wrapper">
	<div id="primary" class="site-content">
		<div id="content" role="main">

			
				
	<article id="post-1297" class="post-1297 post type-post status-publish format-standard hentry category-book-2 category-mongodb category-node-js-2 category-startups category-tutorials tag-express-js tag-expressjs tag-hackhall tag-mongodb tag-node-js tag-rest-api">
				<header class="entry-header">
									<h1 class="entry-title">Express.js and Mongoose Example: Building HackHall</h1>
										<div class="comments-link">
					<a href="http://webapplog.com/express-js-and-mongoose-example-building-hackhall/#comments" title="Comment on Express.js and Mongoose Example: Building HackHall">1 Reply</a>				</div><!-- .comments-link -->
					</header><!-- .entry-header -->

				<div class="entry-content">
			<p><b>Note:</b> This text is a part of the <a href="http://expressjsguide.com/" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-article&#39;,&#39;http://expressjsguide.com&#39;]);">Express.js Guide: The Comprehensive Book on Express.js.</a></p>
<p>The <a href="http://hackhall.com/" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-article&#39;,&#39;http://hackhall.com&#39;]);">HackHall</a> project was written using Backbone.js and Underscore for the front-end app, and Express.js, MongoDB via Mongoose for the back-end REST API server.</p>
<p><span id="more-1297"></span></p>
<p><b>Example</b>: The HackHall source code is in the public <a href="http://github.com/azat-co/hackhall" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-article&#39;,&#39;http://github.com&#39;]);">GitHub repository</a>.</p>
<p>The live demo is accessible at <a href="http://hackhall.com/" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-article&#39;,&#39;http://hackhall.com&#39;]);">hackhall.com</a> either with AngelList or pre-filled email (1@1.com) and password (1).</p>
<h2>What is HackHall</h2>
<p>HackHall (ex-Accelerator.IO) is an open-source invite-only social network and collaboration tool for hackers, hipsters, entrepreneurs and pirates (just kidding). HackHall is akin to Reddit, plus Hacker News, plus Facebook Groups with curation.</p>
<p>The HackHall project is in its early stage and roughly a beta. We plan to extend the code base in the future and bring in more people to share skills, wisdom and passion for programming.</p>
<p>In this chapter, we’ll cover the <a href="https://github.com/azat-co/hackhall/releases/tag/1.0" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-article&#39;,&#39;http://github.com&#39;]);">1.0 release</a> which has:</p>
<ul>
<li>OAuth 1.0 with oauth modules and AngelList API</li>
<li>Email and password authentication</li>
<li>Mongoose models and schemas</li>
<li>Express.js structure with routes in modules</li>
<li>JSON REST API</li>
<li>Express.js error handling</li>
<li>Front-end client Backbone.js app (for more info on Backbone.js, download/read online our <a href="http://rpjs.co/" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-article&#39;,&#39;http://rpjs.co&#39;]);">Rapid Prototyping with JS</a> tutorials)</li>
<li>Environmental variables with Foreman’s <code>.env</code></li>
<li>TDD with Mocha</li>
<li>Basic Makefile setup</li>
</ul>
<h2>Running HackHall</h2>
<p>To get the source code, you can navigate to <code>hackhall</code> folder or clone from GitHub:</p>
<pre><code class="bash hljs ">$ git clone git@github.com:azat-co/hackhall
$ git checkout <span class="hljs-number">1.0</span>
$ npm install</code></pre>
<p>If you plan to test an AngelList (optional), HackHall is using Heroku and Foreman setup for AngelList API keys storing them in environmental variables, so we need to add <code>.evn</code> file like this (below are fake values):</p>
<pre><code class="bash hljs ">ANGELLIST_CLIENT_ID=<span class="hljs-number">254</span>C0335-<span class="hljs-number">5</span>F9A-<span class="hljs-number">4607</span>-<span class="hljs-number">87</span>C0
ANGELLIST_CLIENT_SECRET=<span class="hljs-number">99</span>F5C1AC-C5F7-<span class="hljs-number">44</span>E6-<span class="hljs-number">81</span>A1-<span class="hljs-number">8</span>DF4FC42B8D9</code></pre>
<p>The keys are obtainable at <a href="https://angel.co/api" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-article&#39;,&#39;http://angel.co&#39;]);">angel.co/api</a> after someone creates and registers his/her AngelList app.</p>
<p>Download and install MongoDB if you don’t have it already. The databases and third-party libraries are out of scope of this book. However, you can find enough materials <a href="http://webapplog.com/">online</a> and in <a href="http://rpjs.co/" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-article&#39;,&#39;http://rpjs.co&#39;]);">Rapid Prototyping with JS</a>.</p>
<p>To start MongoDB server, open a new terminal window and run:</p>
<pre><code class="bash hljs ">$ mongod</code></pre>
<p>Go back to the project folder and run:</p>
<pre><code class="bash hljs ">$ foreman start</code></pre>
<p>After MongoDB is running on localhost with default port 27017, it’s possible to seed the database <code>hackhall</code> with default admin user by running <code>seed.js</code> mongo script:</p>
<pre><code class="bash hljs ">$ mongo localhost:<span class="hljs-number">27017</span>/hackhall seed.js</code></pre>
<p>Feel free to modify <code>seed.js</code> to your liking (beware that it erases all previous data!):</p>
<pre markdown="0"><code class="javascript hljs ">db.dropDatabase();
<span class="hljs-keyword">var</span> seedUser ={
  firstName:<span class="hljs-string">'Azat'</span>,
  lastName:<span class="hljs-string">"Mardanov"</span>, 
  displayName:<span class="hljs-string">"Azat Mardanov"</span>,
  password:<span class="hljs-string">'1'</span>,
  email:<span class="hljs-string">'1@1.com'</span>,
  role:<span class="hljs-string">'admin'</span>,
  approved: <span class="hljs-literal">true</span>, 
  admin: <span class="hljs-literal">true</span>
};
db.users.save(seedUser);</code></pre>
<p>If you open your browser at <a href="http://localhost:5000/">http://localhost:5000</a>, you should see the login screen.</p>
<p><img src="./Express.js and Mongoose Example  Building HackHall_files/hackhall-login.png" alt="The HackHall login page running locally."></p>
<p>Enter username and password to get in (the ones from the <code>seed.js</code> file).</p>
<p><img src="./Express.js and Mongoose Example  Building HackHall_files/hackhall-login-filled.png" alt="The HackHall login page with seed data."></p>
<p>After successful authentication, users are redirected to the Posts page:</p>
<p><img src="./Express.js and Mongoose Example  Building HackHall_files/hackhall-posts.png" alt="The HackHall Posts page."></p>
<p>where they can create a post (e.g., a question):</p>
<p><img src="./Express.js and Mongoose Example  Building HackHall_files/hackhall-new-post.png" alt="The HackHall Posts page."></p>
<p>Save the post:</p>
<p><img src="./Express.js and Mongoose Example  Building HackHall_files/hackhall-posts-saved.png" alt="The HackHall Posts page with a saved post."></p>
<p>Like posts:</p>
<p><img src="./Express.js and Mongoose Example  Building HackHall_files/hackhall-posts-liked.png" alt="The HackHall Posts page with a liked post."></p>
<p>Visit other users’ profiles:</p>
<p><img src="./Express.js and Mongoose Example  Building HackHall_files/hackhall-people.png" alt="The HackHall People page."></p>
<p>If they have admin rights, users can approve applicants:</p>
<p><img src="./Express.js and Mongoose Example  Building HackHall_files/hackhall-people-manage.png" alt="The HackHall People page with admin rights."></p>
<p>and manage their account on Profile page:</p>
<p><img src="./Express.js and Mongoose Example  Building HackHall_files/hackhall-profile.png" alt="The HackHall Profile page."></p>
<h2>Structure</h2>
<p>Here are what each of the folders and files have:</p>
<ul>
<li><code>/api</code>: app-shared routes</li>
<li><code>/models</code>: Mongoose models</li>
<li><code>/public</code>: Backbone app, static files like front-end JavaScript, CSS, HTML</li>
<li><code>/routes</code>: REST API routes</li>
<li><code>/tests</code>: Mocha tests</li>
<li><code>.gitignore</code>: list of files that git should ignore</li>
<li><code>Makefile</code>: make file to run tests</li>
<li><code>Procfile</code>: Cedar stack file needed for Heroku deployment</li>
<li><code>package.json</code>: NPM dependencies and HackHall meta data</li>
<li><code>readme.md</code>: description</li>
<li><code>server.js</code>: main HackHall server file</li>
</ul>
<p><img src="./Express.js and Mongoose Example  Building HackHall_files/hackhall-ls.png" alt="Content of the HackHall base folder."></p>
<h2>Express.js App</h2>
<p>Let’s jump straight to the <code>server.js</code> file and learn how it’s implemented. Firstly, we declare dependencies:</p>
<pre><code class="javascript hljs "><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>),
  routes = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./routes'</span>),
  http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>),
  util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>),
  oauth = <span class="hljs-built_in">require</span>(<span class="hljs-string">'oauth'</span>),
  querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">'querystring'</span>);</code></pre>
<p>Then, we initialize app and configure middlewares. The <code>process.env.PORT</code> is populated by Heroku, and in case of a local setup fallsback on 3000.</p>
<pre><code class="javascript hljs "><span class="hljs-keyword">var</span> app = express();
app.configure(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
  app.set(<span class="hljs-string">'port'</span>, process.env.PORT || <span class="hljs-number">3000</span>  );
  app.use(express.favicon());
  app.use(express.logger(<span class="hljs-string">'dev'</span>));
  app.use(express.bodyParser());
  app.use(express.methodOverride());</code></pre>
<p>The values passed to cookieParser and session middlewares are needed for authentication. Obviously, session secrets are supposed to be private:</p>
<pre><code class="javascript hljs ">  app.use(express.cookieParser(<span class="hljs-string">'asd;lfkajs;ldfkj'</span>));
  app.use(express.session({
    secret: <span class="hljs-string">'&lt;h1&gt;WHEEYEEE&lt;/h1&gt;'</span>,
    key: <span class="hljs-string">'sid'</span>,
    cookie: {
      secret: <span class="hljs-literal">true</span>,
      expires: <span class="hljs-literal">false</span>
    }
  }));</code></pre>
<p>This is how we serve our front-end client Backbone.js app and other static files like CSS:</p>
<pre><code class="javascript hljs ">  app.use(express.static(__dirname + <span class="hljs-string">'/public'</span>));
  app.use(app.router);
});</code></pre>
<p>Error handling is broken down into three functions with <code>clientErrorHandler</code> dedicated to AJAX/XHR requests from the Backbone.js app (responds with JSON):</p>
<pre><code class="javascript hljs ">app.configure(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  app.use(logErrors);
  app.use(clientErrorHandler);
  app.use(errorHandler);
});

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logErrors</span><span class="hljs-params">(err, req, res, next)</span> {</span>
  console.error(<span class="hljs-string">'logErrors'</span>, err.toString());
  next(err);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clientErrorHandler</span><span class="hljs-params">(err, req, res, next)</span> {</span>
  console.error(<span class="hljs-string">'clientErrors '</span>, err.toString());
  res.send(<span class="hljs-number">500</span>, { error: err.toString()});
  <span class="hljs-keyword">if</span> (req.xhr) {
    console.error(err);
    res.send(<span class="hljs-number">500</span>, { error: err.toString()});
  } <span class="hljs-keyword">else</span> {
    next(err);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">errorHandler</span><span class="hljs-params">(err, req, res, next)</span> {</span>
  console.error(<span class="hljs-string">'lastErrors '</span>, err.toString());
  res.send(<span class="hljs-number">500</span>, {error: err.toString()});
}</code></pre>
<p>In the same way that we determine <code>process.env.PORT</code> and fallback on local setup value 3000, we do a similar thing with MongoDB connection string:</p>
<pre><code class="javascript hljs "><span class="hljs-keyword">var</span> dbUrl = process.env.MONGOHQ_URL
  || <span class="hljs-string">'mongodb://@127.0.0.1:27017/hackhall'</span>;
<span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">var</span> connection = mongoose.createConnection(dbUrl);
connection.on(<span class="hljs-string">'error'</span>, console.error.bind(console,
  <span class="hljs-string">'connection error:'</span>));</code></pre>
<p>Sometime it’s a good idea to log on the connection open event:</p>
<pre><code class="javascript hljs ">connection.once(<span class="hljs-string">'open'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
  console.info(<span class="hljs-string">'connected to database'</span>)
});</code></pre>
<p>The Mongoose models live in the <code>models</code> folder:</p>
<pre><code class="javascript hljs "><span class="hljs-keyword">var</span> models = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./models'</span>);</code></pre>
<p>This middleware will provide access to two collections within our routes methods:</p>
<pre><code class="javascript hljs "><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">db</span> <span class="hljs-params">(req, res, next)</span> {</span>
  req.db = {
    User: connection.model(<span class="hljs-string">'User'</span>, models.User, <span class="hljs-string">'users'</span>),
    Post: connection.model(<span class="hljs-string">'Post'</span>, models.Post, <span class="hljs-string">'posts'</span>)
  };
  <span class="hljs-keyword">return</span> next();
}</code></pre>
<p>Just a new name for imported auth functions:</p>
<pre><code class="javascript hljs ">checkUser = routes.main.checkUser;
checkAdmin = routes.main.checkAdmin;
checkApplicant = routes.main.checkApplicant;</code></pre>
<p>AngelList OAuth routes:</p>
<pre><code class="javascript hljs ">app.get(<span class="hljs-string">'/auth/angellist'</span>, routes.auth.angelList);
app.get(<span class="hljs-string">'/auth/angellist/callback'</span>,
  routes.auth.angelListCallback,
  routes.auth.angelListLogin,
  db,
  routes.users.findOrAddUser);</code></pre>
<p>Main application routes including <code>api/profile</code> return user session if user is logged in:</p>
<pre><code class="javascript hljs "><span class="hljs-comment">//MAIN</span>
app.get(<span class="hljs-string">'/api/profile'</span>, checkUser, db, routes.main.profile);
app.del(<span class="hljs-string">'/api/profile'</span>, checkUser, db, routes.main.delProfile);
app.post(<span class="hljs-string">'/api/login'</span>, db, routes.main.login);
app.post(<span class="hljs-string">'/api/logout'</span>, routes.main.logout);</code></pre>
<p>The POST requests for creating users and posts:</p>
<pre><code class="javascript hljs "><span class="hljs-comment">//POSTS</span>
app.get(<span class="hljs-string">'/api/posts'</span>, checkUser, db, routes.posts.getPosts);
app.post(<span class="hljs-string">'/api/posts'</span>, checkUser, db, routes.posts.add);
app.get(<span class="hljs-string">'/api/posts/:id'</span>, checkUser, db, routes.posts.getPost);
app.put(<span class="hljs-string">'/api/posts/:id'</span>, checkUser, db, routes.posts.updatePost);
app.del(<span class="hljs-string">'/api/posts/:id'</span>, checkUser, db, routes.posts.del);

<span class="hljs-comment">//USERS</span>
app.get(<span class="hljs-string">'/api/users'</span>, checkUser, db, routes.users.getUsers);
app.get(<span class="hljs-string">'/api/users/:id'</span>, checkUser, db,routes.users.getUser);
app.post(<span class="hljs-string">'/api/users'</span>, checkAdmin, db, routes.users.add);
app.put(<span class="hljs-string">'/api/users/:id'</span>, checkAdmin, db, routes.users.update);
app.del(<span class="hljs-string">'/api/users/:id'</span>, checkAdmin, db, routes.users.del);</code></pre>
<p>These routes are for new members that haven’t been approved yet:</p>
<pre><code class="javascript hljs "><span class="hljs-comment">//APPLICATION</span>
app.post(<span class="hljs-string">'/api/application'</span>,
  checkAdmin,
  db,
  routes.application.add);
app.put(<span class="hljs-string">'/api/application'</span>,
  checkApplicant,
  db,
  routes.application.update);
app.get(<span class="hljs-string">'/api/application'</span>,
  checkApplicant,
  db,
  routes.application.get);</code></pre>
<p>The catch all else route:</p>
<pre><code class="javascript hljs ">app.get(<span class="hljs-string">'*'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span>{</span>
  res.send(<span class="hljs-number">404</span>);
});</code></pre>
<p>The <code>require.main === module</code> is a clever trick to determine if this file is being executed as a stand alone or as an imported module:</p>
<pre><code class="javascript hljs ">http.createServer(app);
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.main === module) {
  app.listen(app.get(<span class="hljs-string">'port'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    console.info(<span class="hljs-string">'Express server listening on port '</span>
      + app.get(<span class="hljs-string">'port'</span>));
  });
}
<span class="hljs-keyword">else</span> {
  console.info(<span class="hljs-string">'Running app as a module'</span>)
  exports.app = app;
}</code></pre>
<p>The full source code for <code>hackhall/server.js</code>:</p>
<pre markdown="0"><code class="javascript hljs "><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>),
  routes = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./routes'</span>),
  http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>),
  util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>),
  oauth = <span class="hljs-built_in">require</span>(<span class="hljs-string">'oauth'</span>),
  querystring = <span class="hljs-built_in">require</span>(<span class="hljs-string">'querystring'</span>);

<span class="hljs-keyword">var</span> app = express();
app.configure(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
  app.set(<span class="hljs-string">'port'</span>, process.env.PORT || <span class="hljs-number">3000</span>  );
  app.use(express.favicon());
  app.use(express.logger(<span class="hljs-string">'dev'</span>));
  app.use(express.bodyParser());
  app.use(express.methodOverride());
  app.use(express.cookieParser(<span class="hljs-string">'asd;lfkajs;ldfkj'</span>));
  app.use(express.session({
    secret: <span class="hljs-string">'&lt;h1&gt;WHEEYEEE&lt;/h1&gt;'</span>,
    key: <span class="hljs-string">'sid'</span>,
    cookie: {
      secret: <span class="hljs-literal">true</span>,
      expires: <span class="hljs-literal">false</span>      
    }
  }));
  <span class="hljs-comment">// app.use(express.csrf());</span>
  <span class="hljs-comment">// app.use(function(req, res, next) {</span>
    <span class="hljs-comment">// res.locals.csrf = req.session._cstf;</span>
    <span class="hljs-comment">// return next();</span>
  <span class="hljs-comment">// });</span>
  app.use(express.static(__dirname + <span class="hljs-string">'/public'</span>));
  app.use(app.router);
});

app.configure(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  app.use(logErrors);
  app.use(clientErrorHandler);
  app.use(errorHandler);
});

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logErrors</span><span class="hljs-params">(err, req, res, next)</span> {</span>
  console.error(<span class="hljs-string">'logErrors'</span>, err.toString());
  next(err);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clientErrorHandler</span><span class="hljs-params">(err, req, res, next)</span> {</span>
  console.error(<span class="hljs-string">'clientErrors '</span>, err.toString());
  res.send(<span class="hljs-number">500</span>, { error: err.toString()});
  <span class="hljs-keyword">if</span> (req.xhr) {
    console.error(err);
    res.send(<span class="hljs-number">500</span>, { error: err.toString()});
  } <span class="hljs-keyword">else</span> {
    next(err);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">errorHandler</span><span class="hljs-params">(err, req, res, next)</span> {</span>
  console.error(<span class="hljs-string">'lastErrors '</span>, err.toString());  
  res.send(<span class="hljs-number">500</span>, {error: err.toString()});
}

<span class="hljs-keyword">var</span> dbUrl = process.env.MONGOHQ_URL || <span class="hljs-string">'mongodb://@127.0.0.1:27017/hackhall'</span>;
<span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">var</span> connection = mongoose.createConnection(dbUrl);
connection.on(<span class="hljs-string">'error'</span>, console.error.bind(console, <span class="hljs-string">'connection error:'</span>));
connection.once(<span class="hljs-string">'open'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
  console.info(<span class="hljs-string">'connected to database'</span>)
});

<span class="hljs-keyword">var</span> models = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./models'</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">db</span> <span class="hljs-params">(req, res, next)</span> {</span>
  req.db = {
    User: connection.model(<span class="hljs-string">'User'</span>, models.User, <span class="hljs-string">'users'</span>),
    Post: connection.model(<span class="hljs-string">'Post'</span>, models.Post, <span class="hljs-string">'posts'</span>)
  };
  <span class="hljs-keyword">return</span> next();
}
checkUser = routes.main.checkUser;
checkAdmin = routes.main.checkAdmin;
checkApplicant = routes.main.checkApplicant;

app.get(<span class="hljs-string">'/auth/angellist'</span>, routes.auth.angelList);
app.get(<span class="hljs-string">'/auth/angellist/callback'</span>,
  routes.auth.angelListCallback, 
  routes.auth.angelListLogin,
  db, 
  routes.users.findOrAddUser);

<span class="hljs-comment">//MAIN</span>
app.get(<span class="hljs-string">'/api/profile'</span>, checkUser, db, routes.main.profile);
app.del(<span class="hljs-string">'/api/profile'</span>, checkUser, db, routes.main.delProfile);
app.post(<span class="hljs-string">'/api/login'</span>, db, routes.main.login);
app.post(<span class="hljs-string">'/api/logout'</span>, routes.main.logout);

<span class="hljs-comment">//POSTS</span>
app.get(<span class="hljs-string">'/api/posts'</span>, checkUser, db, routes.posts.getPosts);
app.post(<span class="hljs-string">'/api/posts'</span>, checkUser, db, routes.posts.add);
app.get(<span class="hljs-string">'/api/posts/:id'</span>, checkUser, db, routes.posts.getPost);
app.put(<span class="hljs-string">'/api/posts/:id'</span>, checkUser, db, routes.posts.updatePost);
app.del(<span class="hljs-string">'/api/posts/:id'</span>, checkUser, db, routes.posts.del);

<span class="hljs-comment">//USERS</span>
app.get(<span class="hljs-string">'/api/users'</span>, checkUser, db, routes.users.getUsers);
app.get(<span class="hljs-string">'/api/users/:id'</span>, checkUser, db,routes.users.getUser);
app.post(<span class="hljs-string">'/api/users'</span>, checkAdmin, db, routes.users.add);
app.put(<span class="hljs-string">'/api/users/:id'</span>, checkAdmin, db, routes.users.update);
app.del(<span class="hljs-string">'/api/users/:id'</span>, checkAdmin, db, routes.users.del);

<span class="hljs-comment">//APPLICATION </span>
app.post(<span class="hljs-string">'/api/application'</span>, checkAdmin, db, routes.application.add); 
app.put(<span class="hljs-string">'/api/application'</span>, checkApplicant, db, routes.application.update);
app.get(<span class="hljs-string">'/api/application'</span>, checkApplicant, db, routes.application.get);

app.get(<span class="hljs-string">'*'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span>{</span>
  res.send(<span class="hljs-number">404</span>);
});

http.createServer(app);
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>.main === module) {
  app.listen(app.get(<span class="hljs-string">'port'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
    console.info(<span class="hljs-string">'Express server listening on port '</span> + app.get(<span class="hljs-string">'port'</span>));
  });
}
<span class="hljs-keyword">else</span> {
  console.info(<span class="hljs-string">'Running app as a module'</span>)
  exports.app = app;
}



</code></pre>
<h2>Routes</h2>
<p>The HackHall routes reside in <code>hackhall/routes</code> folder and are groped into several modules:</p>
<ul>
<li><code>hackhall/routes/index.js</code>: bridge between <code>server.js</code> and other routes in the folder</li>
<li><code>hackhall/routes/auth.js</code>: routes that handle OAuth dance with AngelList API</li>
<li><code>hackhall/routes/main.js</code>: login, logout and other routes</li>
<li><code>hackhall/routes/users.js</code>: routes related to users REST API</li>
<li><code>hackhall/routes/application.js</code>: submission of application to become a user</li>
<li><code>hackhall/routes/posts.js</code>: routes related to posts REST API</li>
</ul>
<h3>index.js</h3>
<p>Let’s peak into <code>hackhall/routes/index.js</code> where we include other modules:</p>
<pre markdown="0"><code class="javascript hljs ">exports.posts = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./posts'</span>);
exports.main = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./main'</span>);
exports.users = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./users'</span>);
exports.application = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./application'</span>);
exports.auth = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./auth'</span>);</code></pre>
<h3>auth.js</h3>
<p>In this module, we’ll handle OAuth <em>dance</em> with AngelList API. To do so, we’ll have to rely on <code>https</code> library:</p>
<pre><code class="javascript hljs "><span class="hljs-keyword">var</span> https = <span class="hljs-built_in">require</span>(<span class="hljs-string">'https'</span>);</code></pre>
<p>The AngelList API client ID and client secret are obtained at <a href="http://angel.co/api" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-article&#39;,&#39;http://angel.co&#39;]);">angel.co/api</a> website and stored in environment variables:</p>
<pre><code class="javascript hljs "><span class="hljs-keyword">var</span> angelListClientId = process.env.ANGELLIST_CLIENT_ID;
<span class="hljs-keyword">var</span> angelListClientSecret = process.env.ANGELLIST_CLIENT_SECRET;</code></pre>
<p>The method will redirect users to angel.co website for authentication:</p>
<pre><code class="javascript hljs ">exports.angelList = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span> {</span>
  res.redirect(<span class="hljs-string">'https://angel.co/api/oauth/authorize?client_id='</span> + angelListClientId + <span class="hljs-string">'&amp;scope=email&amp;response_type=code'</span>);
}</code></pre>
<p>After users allow our app to access their information, AngelList sends them back to this route for us to make a new (HTTPS) request to retrieve the token:</p>
<pre><code class="javascript hljs ">exports.angelListCallback = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">var</span> token;
  <span class="hljs-keyword">var</span> buf = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">var</span> data;
  <span class="hljs-comment">// console.log('/api/oauth/token?client_id='</span>
  <span class="hljs-comment">//+ angelListClientId</span>
  <span class="hljs-comment">//+ '&amp;client_secret='</span>
  <span class="hljs-comment">//+ angelListClientSecret</span>
  <span class="hljs-comment">//+ '&amp;code='</span>
  <span class="hljs-comment">//+ req.query.code</span>
  <span class="hljs-comment">//+ '&amp;grant_type=authorization_code');</span>
  <span class="hljs-keyword">var</span> angelReq = https.request({
      host: <span class="hljs-string">'angel.co'</span>,
      path: <span class="hljs-string">'/api/oauth/token?client_id='</span>
        + angelListClientId
        + <span class="hljs-string">'&amp;client_secret='</span>
        + angelListClientSecret
        + <span class="hljs-string">'&amp;code='</span>
        + req.query.code
        + <span class="hljs-string">'&amp;grant_type=authorization_code'</span>,
      port: <span class="hljs-number">443</span>,
      method: <span class="hljs-string">'POST'</span>,
      headers: {
        <span class="hljs-string">'content-length'</span>: <span class="hljs-number">0</span>
      }
    },
    <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(angelRes)</span> {</span>
      angelRes.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(buffer)</span> {</span>
        buf += buffer;
      });
      angelRes.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">try</span> {
          data = <span class="hljs-built_in">JSON</span>.parse(buf.toString(<span class="hljs-string">'utf-8'</span>));
        } <span class="hljs-keyword">catch</span> (e) {
          <span class="hljs-keyword">if</span> (e) <span class="hljs-keyword">return</span> res.send(e);
        }
        <span class="hljs-keyword">if</span> (!data || !data.access_token) <span class="hljs-keyword">return</span> res.send(<span class="hljs-number">500</span>);
        token = data.access_token;
        req.session.angelListAccessToken = token;
        <span class="hljs-keyword">if</span> (token) next();
        <span class="hljs-keyword">else</span> res.send(<span class="hljs-number">500</span>);
      });
    });
  angelReq.end();
  angelReq.on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
    console.error(e);
    next(e);
  });
}</code></pre>
<p>Directly call AngleList API with the token from the previous middleware to get user information:</p>
<pre><code class="javascript hljs ">exports.angelListLogin = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  token = req.session.angelListAccessToken;
  httpsRequest = https.request({
      host: <span class="hljs-string">'api.angel.co'</span>,
      path: <span class="hljs-string">'/1/me?access_token='</span> + token,
      port: <span class="hljs-number">443</span>,
      method: <span class="hljs-string">'GET'</span>
    },
    <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(httpsResponse)</span> {</span>
      httpsResponse.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(buffer)</span> {</span>
        data = <span class="hljs-built_in">JSON</span>.parse(buffer.toString(<span class="hljs-string">'utf-8'</span>));
        <span class="hljs-keyword">if</span> (data) {
          req.angelProfile = data;
          next();
        }
      });
    }
  );
  httpsRequest.end();
  httpsRequest.on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
    console.error(e);
  });
};</code></pre>
<p>The full source code for <code>hackhall/routes/auth.js</code> files:</p>
<pre markdown="0"><code class="javascript hljs "><span class="hljs-keyword">var</span> https = <span class="hljs-built_in">require</span>(<span class="hljs-string">'https'</span>);

<span class="hljs-keyword">var</span> angelListClientId = process.env.ANGELLIST_CLIENT_ID;
<span class="hljs-keyword">var</span> angelListClientSecret = process.env.ANGELLIST_CLIENT_SECRET;

exports.angelList = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span> {</span>
  res.redirect(<span class="hljs-string">'https://angel.co/api/oauth/authorize?client_id='</span> + angelListClientId + <span class="hljs-string">'&amp;scope=email&amp;response_type=code'</span>);
}
exports.angelListCallback = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">var</span> token;
  <span class="hljs-keyword">var</span> buf = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">var</span> data;
  <span class="hljs-comment">// console.log('/api/oauth/token?client_id=' + angelListClientId + '&amp;client_secret=' + angelListClientSecret + '&amp;code=' + req.query.code + '&amp;grant_type=authorization_code');</span>
  <span class="hljs-keyword">var</span> angelReq = https.request({
      host: <span class="hljs-string">'angel.co'</span>,
      path: <span class="hljs-string">'/api/oauth/token?client_id='</span> + angelListClientId + <span class="hljs-string">'&amp;client_secret='</span> + angelListClientSecret + <span class="hljs-string">'&amp;code='</span> + req.query.code + <span class="hljs-string">'&amp;grant_type=authorization_code'</span>,
      port: <span class="hljs-number">443</span>,
      method: <span class="hljs-string">'POST'</span>,
      headers: {
        <span class="hljs-string">'content-length'</span>: <span class="hljs-number">0</span>
      }
    },
    <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(angelRes)</span> {</span>

      angelRes.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(buffer)</span> {</span>
        buf += buffer;
      });
      angelRes.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">try</span> {
          data = <span class="hljs-built_in">JSON</span>.parse(buf.toString(<span class="hljs-string">'utf-8'</span>));
        } <span class="hljs-keyword">catch</span> (e) {
          <span class="hljs-keyword">if</span> (e) <span class="hljs-keyword">return</span> res.send(e);
        }
        <span class="hljs-keyword">if</span> (!data || !data.access_token) <span class="hljs-keyword">return</span> res.send(<span class="hljs-number">500</span>);
        token = data.access_token;
        req.session.angelListAccessToken = token;
        <span class="hljs-keyword">if</span> (token) next();
        <span class="hljs-keyword">else</span> res.send(<span class="hljs-number">500</span>);
      });
    });
  angelReq.end();
  angelReq.on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
    console.error(e);
    next(e);
  });
}
exports.angelListLogin = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  token = req.session.angelListAccessToken;
  httpsRequest = https.request({
      host: <span class="hljs-string">'api.angel.co'</span>,
      path: <span class="hljs-string">'/1/me?access_token='</span> + token,
      port: <span class="hljs-number">443</span>,
      method: <span class="hljs-string">'GET'</span>
    },
    <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(httpsResponse)</span> {</span>
      httpsResponse.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(buffer)</span> {</span>
        data = <span class="hljs-built_in">JSON</span>.parse(buffer.toString(<span class="hljs-string">'utf-8'</span>));
        <span class="hljs-keyword">if</span> (data) {
          req.angelProfile = data;
          next();
        }
      });
    }
  );
  httpsRequest.end();
  httpsRequest.on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
    console.error(e);
  });
};</code></pre>
<h3>main.js</h3>
<p>The <code>hackhall/routes/main.js</code> file might be interesting as well.</p>
<p>The <code>checkAdmin()</code> function performs authentication for admin privileges. If the session object doesn’t carry proper flag, we call Express.js <code>next()</code> function with an error object:</p>
<pre><code class="javascript hljs ">exports.checkAdmin = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(request, response, next)</span> {</span>
  <span class="hljs-keyword">if</span> (request.session
    &amp;&amp; request.session.auth
    &amp;&amp; request.session.userId
    &amp;&amp; request.session.admin) {
    console.info(<span class="hljs-string">'Access ADMIN: '</span> + request.session.userId);
    <span class="hljs-keyword">return</span> next();
  } <span class="hljs-keyword">else</span> {
    next(<span class="hljs-string">'User is not an administrator.'</span>);
  }
};</code></pre>
<p>Similarly, we can check only for the user without checking for admin rights:</p>
<pre><code class="javascript hljs ">exports.checkUser = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">if</span> (req.session &amp;&amp; req.session.auth &amp;&amp; req.session.userId
    &amp;&amp; (req.session.user.approved || req.session.admin)) {
    console.info(<span class="hljs-string">'Access USER: '</span> + req.session.userId);
    <span class="hljs-keyword">return</span> next();
  } <span class="hljs-keyword">else</span> {
    next(<span class="hljs-string">'User is not logged in.'</span>);
  }
};</code></pre>
<p>Application is just an unapproved user object and we can also check for that:</p>
<pre><code class="javascript hljs ">exports.checkApplicant = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">if</span> (req.session &amp;&amp; req.session.auth &amp;&amp; req.session.userId
    &amp;&amp; (!req.session.user.approved || req.session.admin)) {
    console.info(<span class="hljs-string">'Access USER: '</span> + req.session.userId);
    <span class="hljs-keyword">return</span> next();
  } <span class="hljs-keyword">else</span> {
    next(<span class="hljs-string">'User is not logged in.'</span>);
  }
};</code></pre>
<p>In the login function, we search for email and password matches in the database. On success, we store the user object in the session and proceed; otherwise the request fails:</p>
<pre><code class="javascript hljs ">exports.login = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  req.db.User.findOne({
      email: req.body.email,
      password: req.body.password
    },
    <span class="hljs-literal">null</span>, {
      safe: <span class="hljs-literal">true</span>
    },
    <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, user)</span> {</span>
      <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> next(err);
      <span class="hljs-keyword">if</span> (user) {
        req.session.auth = <span class="hljs-literal">true</span>;
        req.session.userId = user._id.toHexString();
        req.session.user = user;
        <span class="hljs-keyword">if</span> (user.admin) {
          req.session.admin = <span class="hljs-literal">true</span>;
        }
        console.info(<span class="hljs-string">'Login USER: '</span> + req.session.userId);
        res.json(<span class="hljs-number">200</span>, {
          msg: <span class="hljs-string">'Authorized'</span>
        });
      } <span class="hljs-keyword">else</span> {
        next(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'User is not found.'</span>));
      }
    });
};</code></pre>
<p>The logging out process removes any session information:</p>
<pre><code class="javascript hljs ">exports.logout = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span> {</span>
  console.info(<span class="hljs-string">'Logout USER: '</span> + req.session.userId);
  req.session.destroy(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error)</span> {</span>
    <span class="hljs-keyword">if</span> (!error) {
      res.send({
        msg: <span class="hljs-string">'Logged out'</span>
      });
    }
  });
};</code></pre>
<p>This route is used for both the Profile page as well as by Backbone.js for user authentication:</p>
<pre><code class="javascript hljs ">exports.profile = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  req.db.User.findById(req.session.userId, <span class="hljs-string">'firstName lastName'</span>
      + <span class="hljs-string">'displayName headline photoUrl admin'</span>
      + <span class="hljs-string">'approved banned role angelUrl twitterUrl'</span>
      + <span class="hljs-string">'facebookUrl linkedinUrl githubUrl'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (err) next(err);
    <span class="hljs-keyword">if</span> (!obj) next(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'User is not found'</span>));
    req.db.Post.find({
      author: {
        id: obj._id,
        name: obj.displayName
      }
    }, <span class="hljs-literal">null</span>, {
      sort: {
        <span class="hljs-string">'created'</span>: -<span class="hljs-number">1</span>
      }
    }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, list)</span> {</span>
      <span class="hljs-keyword">if</span> (err) next(err);
      obj.posts.own = list || [];
      req.db.Post.find({
        likes: obj._id
      }, <span class="hljs-literal">null</span>, {
        sort: {
          <span class="hljs-string">'created'</span>: -<span class="hljs-number">1</span>
        }</code></pre>
<p>This logic finds Posts and Comments made by the user:</p>
<pre><code class="javascript hljs ">      }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, list)</span> {</span>
        <span class="hljs-keyword">if</span> (err) next(err);
        obj.posts.likes = list || [];
        req.db.Post.find({
          watches: obj._id
        }, <span class="hljs-literal">null</span>, {
          sort: {
            <span class="hljs-string">'created'</span>: -<span class="hljs-number">1</span>
          }
        }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, list)</span> {</span>
          <span class="hljs-keyword">if</span> (err) next(err);
          obj.posts.watches = list || [];
          req.db.Post.find({
            <span class="hljs-string">'comments.author.id'</span>: obj._id
          }, <span class="hljs-literal">null</span>, {
            sort: {
              <span class="hljs-string">'created'</span>: -<span class="hljs-number">1</span>
            }
          }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, list)</span> {</span>
            <span class="hljs-keyword">if</span> (err) next(err);
            obj.posts.comments = [];
            list.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, key, list)</span> {</span>
              obj.posts.comments.push(
                value.comments.filter(
                  <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el, i, arr)</span> {</span>
                    <span class="hljs-keyword">return</span> (el.author.id.toString() == obj._id.toString());
                  }
                )
              );
            });
            res.json(<span class="hljs-number">200</span>, obj);
          });
        });
      });
    });
  });
};</code></pre>
<p>It’s important to allow users to delete their profiles:</p>
<pre><code class="javascript hljs ">exports.delProfile = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  console.log(<span class="hljs-string">'del profile'</span>);
  console.log(req.session.userId);
  req.db.User.findByIdAndRemove(req.session.user._id, {},
    <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
      <span class="hljs-keyword">if</span> (err) next(err);
      req.session.destroy(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error)</span> {</span>
        <span class="hljs-keyword">if</span> (err) {
          next(err)
        }
      });
      res.json(<span class="hljs-number">200</span>, obj);
    }
  );
};</code></pre>
<p>The full source code of <code>hackhall/routes/main.js</code> files:</p>
<pre markdown="0"><code class="javascript hljs ">exports.checkAdmin = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(request, response, next)</span> {</span>
  <span class="hljs-keyword">if</span> (request.session &amp;&amp; request.session.auth &amp;&amp; request.session.userId &amp;&amp; request.session.admin) {
    console.info(<span class="hljs-string">'Access ADMIN: '</span> + request.session.userId);
    <span class="hljs-keyword">return</span> next();
  } <span class="hljs-keyword">else</span> {
    next(<span class="hljs-string">'User is not an administrator.'</span>);
  }
};

exports.checkUser = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">if</span> (req.session &amp;&amp; req.session.auth &amp;&amp; req.session.userId &amp;&amp; (req.session.user.approved || req.session.admin)) {
    console.info(<span class="hljs-string">'Access USER: '</span> + req.session.userId);
    <span class="hljs-keyword">return</span> next();
  } <span class="hljs-keyword">else</span> {
    next(<span class="hljs-string">'User is not logged in.'</span>);
  }
};

exports.checkApplicant = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">if</span> (req.session &amp;&amp; req.session.auth &amp;&amp; req.session.userId &amp;&amp; (!req.session.user.approved || req.session.admin)) {
    console.info(<span class="hljs-string">'Access USER: '</span> + req.session.userId);
    <span class="hljs-keyword">return</span> next();
  } <span class="hljs-keyword">else</span> {
    next(<span class="hljs-string">'User is not logged in.'</span>);
  }
};

exports.login = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  req.db.User.findOne({
      email: req.body.email,
      password: req.body.password
    },
    <span class="hljs-literal">null</span>, {
      safe: <span class="hljs-literal">true</span>
    },
    <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, user)</span> {</span>
      <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> next(err);
      <span class="hljs-keyword">if</span> (user) {
        req.session.auth = <span class="hljs-literal">true</span>;
        req.session.userId = user._id.toHexString();
        req.session.user = user;
        <span class="hljs-keyword">if</span> (user.admin) {
          req.session.admin = <span class="hljs-literal">true</span>;
        }
        console.info(<span class="hljs-string">'Login USER: '</span> + req.session.userId);
        res.json(<span class="hljs-number">200</span>, {
          msg: <span class="hljs-string">'Authorized'</span>
        });
      } <span class="hljs-keyword">else</span> {
        next(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'User is not found.'</span>));
      }
    });
};

exports.logout = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res)</span> {</span>
  console.info(<span class="hljs-string">'Logout USER: '</span> + req.session.userId);
  req.session.destroy(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error)</span> {</span>
    <span class="hljs-keyword">if</span> (!error) {
      res.send({
        msg: <span class="hljs-string">'Logged out'</span>
      });
    }
  });
};

exports.profile = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  req.db.User.findById(req.session.userId, <span class="hljs-string">'firstName lastName displayName headline photoUrl admin approved banned role angelUrl twitterUrl facebookUrl linkedinUrl githubUrl'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (err) next(err);
    <span class="hljs-keyword">if</span> (!obj) next(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'User is not found'</span>));
    req.db.Post.find({
      author: {
        id: obj._id,
        name: obj.displayName
      }
    }, <span class="hljs-literal">null</span>, {
      sort: {
        <span class="hljs-string">'created'</span>: -<span class="hljs-number">1</span>
      }
    }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, list)</span> {</span>
      <span class="hljs-keyword">if</span> (err) next(err);
      obj.posts.own = list || [];
      req.db.Post.find({
        likes: obj._id
      }, <span class="hljs-literal">null</span>, {
        sort: {
          <span class="hljs-string">'created'</span>: -<span class="hljs-number">1</span>
        }
      }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, list)</span> {</span>
        <span class="hljs-keyword">if</span> (err) next(err);
        obj.posts.likes = list || [];
        req.db.Post.find({
          watches: obj._id
        }, <span class="hljs-literal">null</span>, {
          sort: {
            <span class="hljs-string">'created'</span>: -<span class="hljs-number">1</span>
          }
        }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, list)</span> {</span>
          <span class="hljs-keyword">if</span> (err) next(err);
          obj.posts.watches = list || [];
          req.db.Post.find({
            <span class="hljs-string">'comments.author.id'</span>: obj._id
          }, <span class="hljs-literal">null</span>, {
            sort: {
              <span class="hljs-string">'created'</span>: -<span class="hljs-number">1</span>
            }
          }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, list)</span> {</span>
            <span class="hljs-keyword">if</span> (err) next(err);
            obj.posts.comments = [];
            list.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, key, list)</span> {</span>
              obj.posts.comments.push(value.comments.filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el, i, arr)</span> {</span>
                <span class="hljs-keyword">return</span> (el.author.id.toString() == obj._id.toString());
              }));
            });
            res.json(<span class="hljs-number">200</span>, obj);
          });
        });
      });
    });
  });
};

exports.delProfile = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  console.log(<span class="hljs-string">'del profile'</span>);
  console.log(req.session.userId);
  req.db.User.findByIdAndRemove(req.session.user._id, {}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (err) next(err);
    req.session.destroy(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error)</span> {</span>
      <span class="hljs-keyword">if</span> (err) {
        next(err)
      }
    });
    res.json(<span class="hljs-number">200</span>, obj);
  });
};</code></pre>
<h3>users.js</h3>
<p>The full source code for <code>hackhall/routes/users.js</code> files:</p>
<pre markdown="0"><code class="javascript hljs ">objectId = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).ObjectID;

exports.getUsers = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">if</span> (req.session.auth &amp;&amp; req.session.userId) {
    req.db.User.find({}, <span class="hljs-string">'firstName lastName displayName headline photoUrl admin approved banned role angelUrl twitterUrl facebookUrl linkedinUrl githubUrl'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, list)</span> {</span>
      <span class="hljs-keyword">if</span> (err) next(err);
      res.json(<span class="hljs-number">200</span>, list);
    });
  } <span class="hljs-keyword">else</span> {
    next(<span class="hljs-string">'User is not recognized.'</span>)
  }
}

exports.getUser = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  req.db.User.findById(req.params.id, <span class="hljs-string">'firstName lastName displayName headline photoUrl admin approved banned role angelUrl twitterUrl facebookUrl linkedinUrl githubUrl'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (err) next(err);
    <span class="hljs-keyword">if</span> (!obj) next(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'User is not found'</span>));
    req.db.Post.find({
      author: {
        id: obj._id,
        name: obj.displayName
      }
    }, <span class="hljs-literal">null</span>, {
      sort: {
        <span class="hljs-string">'created'</span>: -<span class="hljs-number">1</span>
      }
    }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, list)</span> {</span>
      <span class="hljs-keyword">if</span> (err) next(err);
      obj.posts.own = list || [];
      req.db.Post.find({
        likes: obj._id
      }, <span class="hljs-literal">null</span>, {
        sort: {
          <span class="hljs-string">'created'</span>: -<span class="hljs-number">1</span>
        }
      }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, list)</span> {</span>
        <span class="hljs-keyword">if</span> (err) next(err);
        obj.posts.likes = list || [];
        req.db.Post.find({
          watches: obj._id
        }, <span class="hljs-literal">null</span>, {
          sort: {
            <span class="hljs-string">'created'</span>: -<span class="hljs-number">1</span>
          }
        }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, list)</span> {</span>
          <span class="hljs-keyword">if</span> (err) next(err);
          obj.posts.watches = list || [];
          req.db.Post.find({
            <span class="hljs-string">'comments.author.id'</span>: obj._id
          }, <span class="hljs-literal">null</span>, {
            sort: {
              <span class="hljs-string">'created'</span>: -<span class="hljs-number">1</span>
            }
          }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, list)</span> {</span>
            <span class="hljs-keyword">if</span> (err) next(err);
            obj.posts.comments = [];
            list.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, key, list)</span> {</span>
              obj.posts.comments.push(value.comments.filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el, i, arr)</span> {</span>
                <span class="hljs-keyword">return</span> (el.author.id.toString() == obj._id.toString());
              }));
            });
            res.json(<span class="hljs-number">200</span>, obj);
          });
        });
      });
    });
  });
};

exports.add = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">new</span> req.db.User(req.body);
  user.save(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span> {</span>
    <span class="hljs-keyword">if</span> (err) next(err);
    res.json(user);
  });
};

exports.update = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">var</span> obj = req.body;
  obj.updated = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
  <span class="hljs-keyword">delete</span> obj._id;
  req.db.User.findByIdAndUpdate(req.params.id, {
    $set: obj
  }, {
    <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>
  }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (err) next(err);
    res.json(<span class="hljs-number">200</span>, obj);
  });
};

exports.del = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  req.db.User.findByIdAndRemove(req.params.id, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (err) next(err);
    res.json(<span class="hljs-number">200</span>, obj);
  });
};

exports.findOrAddUser = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  data = req.angelProfile;
  req.db.User.findOne({
    angelListId: data.id
  }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    console.log(<span class="hljs-string">'angelListLogin4'</span>);
    <span class="hljs-keyword">if</span> (err) next(err);
    console.warn(obj);
    <span class="hljs-keyword">if</span> (!obj) {
      req.db.User.create({
        angelListId: data.id,
        angelToken: token,
        angelListProfile: data,
        email: data.email,
        firstName: data.name.split(<span class="hljs-string">' '</span>)[<span class="hljs-number">0</span>],
        lastName: data.name.split(<span class="hljs-string">' '</span>)[<span class="hljs-number">1</span>],
        displayName: data.name,
        headline: data.bio,
        photoUrl: data.image,
        angelUrl: data.angellist_url,
        twitterUrl: data.twitter_url,
        facebookUrl: data.facebook_url,
        linkedinUrl: data.linkedin_url,
        githubUrl: data.github_url
      }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span> <span class="hljs-comment">//remember the scope of variables!</span>
        <span class="hljs-keyword">if</span> (err) next(err);
        console.log(obj);
        req.session.auth = <span class="hljs-literal">true</span>;
        req.session.userId = obj._id;
        req.session.user = obj;
        req.session.admin = <span class="hljs-literal">false</span>; <span class="hljs-comment">//assing regular user role by default                  </span>
        res.redirect(<span class="hljs-string">'/#application'</span>);
        <span class="hljs-comment">// }</span>
      });
    } <span class="hljs-keyword">else</span> { <span class="hljs-comment">//user is in the database</span>
      req.session.auth = <span class="hljs-literal">true</span>;
      req.session.userId = obj._id;
      req.session.user = obj;
      req.session.admin = obj.admin; <span class="hljs-comment">//false; //assing regular user role by default</span>
      <span class="hljs-keyword">if</span> (obj.approved) {
        res.redirect(<span class="hljs-string">'/#posts'</span>);
      } <span class="hljs-keyword">else</span> {
        res.redirect(<span class="hljs-string">'/#application'</span>);
      }
    }
  })
}</code></pre>
<h3>applications.js</h3>
<p>In the current version, submitting and approving an application won’t trigger an email notification. Therefore, users have to comeback to the website to check their status.</p>
<p>Merely add a user object (with approved=false by default) to the database:</p>
<pre><code class="javascript hljs ">exports.add = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  req.db.User.create({
    firstName: req.body.firstName,
    lastName: req.body.lastName,
    displayName: req.body.displayName,
    headline: req.body.headline,
    photoUrl: req.body.photoUrl,
    password: req.body.password,
    email: req.body.email,
    angelList: {
      blah: <span class="hljs-string">'blah'</span>
    },
    angelUrl: req.body.angelUrl,
    twitterUrl: req.body.twitterUrl,
    facebookUrl: req.body.facebookUrl,
    linkedinUrl: req.body.linkedinUrl,
    githubUrl: req.body.githubUrl
  }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (err) next(err);
    <span class="hljs-keyword">if</span> (!obj) next(<span class="hljs-string">'Cannot create.'</span>)
    res.json(<span class="hljs-number">200</span>, obj);
  })
};</code></pre>
<p>Let the users update information in their applications:</p>
<pre><code class="javascript hljs ">exports.update = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">var</span> data = {};
  <span class="hljs-built_in">Object</span>.keys(req.body).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(k)</span> {</span>
    <span class="hljs-keyword">if</span> (req.body[k]) {
      data[k] = req.body[k];
    }
  });
  <span class="hljs-keyword">delete</span> data._id;
  req.db.User.findByIdAndUpdate(req.session.user._id, {
    $set: data
  }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (err) next(err);
    <span class="hljs-keyword">if</span> (!obj) next(<span class="hljs-string">'Cannot save.'</span>)
    res.json(<span class="hljs-number">200</span>, obj);
  });
};</code></pre>
<p>Select a particular object with the <code>get()</code> function:</p>
<pre><code class="javascript hljs ">exports.get = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  req.db.User.findById(req.session.user._id,
    <span class="hljs-string">'firstName lastName photoUrl headline displayName'</span>
      + <span class="hljs-string">'angelUrl facebookUrl twitterUrl linkedinUrl'</span>
      + <span class="hljs-string">'githubUrl'</span>, {}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
      <span class="hljs-keyword">if</span> (err) next(err);
      <span class="hljs-keyword">if</span> (!obj) next(<span class="hljs-string">'cannot find'</span>);
      res.json(<span class="hljs-number">200</span>, obj);
    })
};</code></pre>
<p>The full source code of <code>hackhall/routes/applications.js</code> files:</p>
<pre markdown="0"><code class="javascript hljs ">***<span class="hljs-built_in">Error</span>:** File <span class="hljs-string">"applications.js"</span> does not exist at <span class="hljs-keyword">this</span> path*</code></pre>
<h3>posts.js</h3>
<p>The last routes module that we bisect is <code>hackhall/routes/posts.js</code>. It takes care of adding, editing and removing posts, as well as commenting, watching and liking.</p>
<p>We use object ID for conversion from HEX strings to proper objects:</p>
<pre><code class="javascript hljs ">objectId = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).ObjectID;</code></pre>
<p>The coloring is nice for logging but of course optional. We accomplish it with escape sequences:</p>
<pre><code class="javascript hljs "><span class="hljs-keyword">var</span> red, blue, reset;
red   = <span class="hljs-string">'\u001b[31m'</span>;
blue  = <span class="hljs-string">'\u001b[34m'</span>;
reset = <span class="hljs-string">'\u001b[0m'</span>;
console.log(red + <span class="hljs-string">'This is red'</span> + reset + <span class="hljs-string">' while '</span> + blue + <span class="hljs-string">' this is blue'</span> + reset);</code></pre>
<p>The default values for the pagination of posts:</p>
<pre><code class="javascript hljs "><span class="hljs-keyword">var</span> LIMIT = <span class="hljs-number">10</span>;
<span class="hljs-keyword">var</span> SKIP = <span class="hljs-number">0</span>;</code></pre>
<p>The <code>add()</code> function handles creation of new posts:</p>
<pre><code class="javascript hljs ">exports.add = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">if</span> (req.body) {
    req.db.Post.create({
      title: req.body.title,
      text: req.body.text || <span class="hljs-literal">null</span>,
      url: req.body.url || <span class="hljs-literal">null</span>,
      author: {
        id: req.session.user._id,
        name: req.session.user.displayName
      }
    }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, docs)</span> {</span>
      <span class="hljs-keyword">if</span> (err) {
        console.error(err);
        next(err);
      } <span class="hljs-keyword">else</span> {
        res.json(<span class="hljs-number">200</span>, docs);
      }

    });
  } <span class="hljs-keyword">else</span> {
    next(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'No data'</span>));
  }
};</code></pre>
<p>To retrieve the list of posts:</p>
<pre><code class="javascript hljs ">
exports.getPosts = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">var</span> limit = req.query.limit || LIMIT;
  <span class="hljs-keyword">var</span> skip = req.query.skip || SKIP;
  req.db.Post.find({}, <span class="hljs-literal">null</span>, {
    limit: limit,
    skip: skip,
    sort: {
      <span class="hljs-string">'_id'</span>: -<span class="hljs-number">1</span>
    }
  }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (!obj) next(<span class="hljs-string">'There are not posts.'</span>);
    obj.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(item, i, list)</span> {</span>
      <span class="hljs-keyword">if</span> (req.session.user.admin) {
        item.admin = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        item.admin = <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">if</span> (item.author.id == req.session.userId) {
        item.own = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        item.own = <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">if</span> (item.likes
        &amp;&amp; item.likes.indexOf(req.session.userId) &gt; -<span class="hljs-number">1</span>) {
        item.like = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        item.like = <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">if</span> (item.watches
        &amp;&amp; item.watches.indexOf(req.session.userId) &gt; -<span class="hljs-number">1</span>) {
        item.watch = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        item.watch = <span class="hljs-literal">false</span>;
      }
    });
    <span class="hljs-keyword">var</span> body = {};
    body.limit = limit;
    body.skip = skip;
    body.posts = obj;
    req.db.Post.count({}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, total)</span> {</span>
      <span class="hljs-keyword">if</span> (err) next(err);
      body.total = total;
      res.json(<span class="hljs-number">200</span>, body);
    });
  });
};</code></pre>
<p>For the individual post page, we need the <code>getPost()</code> method:</p>
<pre><code class="javascript hljs ">exports.getPost = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">if</span> (req.params.id) {
    req.db.Post.findById(req.params.id, {
      title: <span class="hljs-literal">true</span>,
      text: <span class="hljs-literal">true</span>,
      url: <span class="hljs-literal">true</span>,
      author: <span class="hljs-literal">true</span>,
      comments: <span class="hljs-literal">true</span>,
      watches: <span class="hljs-literal">true</span>,
      likes: <span class="hljs-literal">true</span>
    }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
      <span class="hljs-keyword">if</span> (err) next(err);
      <span class="hljs-keyword">if</span> (!obj) {
        next(<span class="hljs-string">'Nothing is found.'</span>);
      } <span class="hljs-keyword">else</span> {
        res.json(<span class="hljs-number">200</span>, obj);
      }
    });
  } <span class="hljs-keyword">else</span> {
    next(<span class="hljs-string">'No post id'</span>);
  }
};</code></pre>
<p>The <code>del()</code> function removes specific posts from the database. The <code>findById()</code> and <code>remove()</code> methods from Mongoose are used in this snippet. However, the same thing can be accomplished with just <code>remove()</code>.</p>
<pre><code class="javascript hljs ">exports.del = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  req.db.Post.findById(req.params.id, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (err) next(err);
    <span class="hljs-keyword">if</span> (req.session.admin || req.session.userId === obj.author.id) {
      obj.remove();
      res.json(<span class="hljs-number">200</span>, obj);
    } <span class="hljs-keyword">else</span> {
      next(<span class="hljs-string">'User is not authorized to delete post.'</span>);
    }
  })
};</code></pre>
<p>To like the post, we update the post item by prepending <code>post.likes</code> array with the ID of the user:</p>
<pre><code class="javascript hljs "><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">likePost</span><span class="hljs-params">(req, res, next)</span> {</span>
  req.db.Post.findByIdAndUpdate(req.body._id, {
    $push: {
      likes: req.session.userId
    }
  }, {}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (err) {
      next(err);
    } <span class="hljs-keyword">else</span> {
      res.json(<span class="hljs-number">200</span>, obj);
    }
  });
};</code></pre>
<p>Likewise, when a user performs the watch action, the system adds a new ID to the <code>post.watches</code> array:</p>
<pre><code class="javascript hljs "><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">watchPost</span><span class="hljs-params">(req, res, next)</span> {</span>
  req.db.Post.findByIdAndUpdate(req.body._id, {
    $push: {
      watches: req.session.userId
    }
  }, {}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (err) next(err);
    <span class="hljs-keyword">else</span> {
      res.json(<span class="hljs-number">200</span>, obj);
    }
  });
};</code></pre>
<p>The <code>updatePost()</code> is what calls like or watch functions based on the action flag sent with request. In addition, the <code>updatePost()</code> processes the changes to the post and comments:</p>
<pre><code class="javascript hljs ">
exports.updatePost = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">var</span> anyAction = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">if</span> (req.body._id &amp;&amp; req.params.id) {
    <span class="hljs-keyword">if</span> (req.body &amp;&amp; req.body.action == <span class="hljs-string">'like'</span>) {
      anyAction = <span class="hljs-literal">true</span>;
      likePost(req, res);
    }
    <span class="hljs-keyword">if</span> (req.body &amp;&amp; req.body.action == <span class="hljs-string">'watch'</span>) {
      anyAction = <span class="hljs-literal">true</span>;
      watchPost(req, res);
    }
    <span class="hljs-keyword">if</span> (req.body &amp;&amp; req.body.action == <span class="hljs-string">'comment'</span>
      &amp;&amp; req.body.comment &amp;&amp; req.params.id) {
      anyAction = <span class="hljs-literal">true</span>;
      req.db.Post.findByIdAndUpdate(req.params.id, {
        $push: {
          comments: {
            author: {
              id: req.session.userId,
              name: req.session.user.displayName
            },
            text: req.body.comment
          }
        }
      }, {
        safe: <span class="hljs-literal">true</span>,
        <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>
      }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
        res.json(<span class="hljs-number">200</span>, obj);
      });
    }
    <span class="hljs-keyword">if</span> (req.session.auth &amp;&amp; req.session.userId &amp;&amp; req.body
      &amp;&amp; req.body.action != <span class="hljs-string">'comment'</span> &amp;&amp;
      req.body.action != <span class="hljs-string">'watch'</span> &amp;&amp; req.body != <span class="hljs-string">'like'</span> &amp;&amp;
      req.params.id &amp;&amp; (req.body.author.id == req.session.user._id
      || req.session.user.admin)) {
      req.db.Post.findById(req.params.id, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, doc)</span> {</span>
        <span class="hljs-keyword">if</span> (err) next(err);
        doc.title = req.body.title;
        doc.text = req.body.text || <span class="hljs-literal">null</span>;
        doc.url = req.body.url || <span class="hljs-literal">null</span>;
        doc.save(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e, d)</span> {</span>
          <span class="hljs-keyword">if</span> (e) next(e);
          res.json(<span class="hljs-number">200</span>, d);
        });
      })
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (!anyAction) next(<span class="hljs-string">'Something went wrong.'</span>);
    }

  } <span class="hljs-keyword">else</span> {
    next(<span class="hljs-string">'No post ID.'</span>);
  }
};</code></pre>
<p>The full source code for the <code>hackhall/routes/posts.js</code> file:</p>
<pre markdown="0"><code class="javascript hljs ">objectId = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>).ObjectID;
<span class="hljs-keyword">var</span> red, blue, reset;
red = <span class="hljs-string">'\u001b[31m'</span>;
blue = <span class="hljs-string">'\u001b[34m'</span>;
reset = <span class="hljs-string">'\u001b[0m'</span>;
console.log(red + <span class="hljs-string">'This is red'</span> + reset + <span class="hljs-string">' while '</span> + blue + <span class="hljs-string">' this is blue'</span> + reset);

<span class="hljs-keyword">var</span> LIMIT = <span class="hljs-number">10</span>;
<span class="hljs-keyword">var</span> SKIP = <span class="hljs-number">0</span>;

exports.add = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">if</span> (req.body) {
    req.db.Post.create({
      title: req.body.title,
      text: req.body.text || <span class="hljs-literal">null</span>,
      url: req.body.url || <span class="hljs-literal">null</span>,
      author: {
        id: req.session.user._id,
        name: req.session.user.displayName
      }
    }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, docs)</span> {</span>
      <span class="hljs-keyword">if</span> (err) {
        console.error(err);
        next(err);
      } <span class="hljs-keyword">else</span> {
        res.json(<span class="hljs-number">200</span>, docs);
      }

    });
  } <span class="hljs-keyword">else</span> {
    next(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'No data'</span>));
  }
};

exports.getPosts = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">var</span> limit = req.query.limit || LIMIT;
  <span class="hljs-keyword">var</span> skip = req.query.skip || SKIP;
  req.db.Post.find({}, <span class="hljs-literal">null</span>, {
    limit: limit,
    skip: skip,
    sort: {
      <span class="hljs-string">'_id'</span>: -<span class="hljs-number">1</span>
    }
  }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (!obj) next(<span class="hljs-string">'There are not posts.'</span>);
    obj.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(item, i, list)</span> {</span>
      <span class="hljs-keyword">if</span> (req.session.user.admin) {
        item.admin = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        item.admin = <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">if</span> (item.author.id == req.session.userId) {
        item.own = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        item.own = <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">if</span> (item.likes &amp;&amp; item.likes.indexOf(req.session.userId) &gt; -<span class="hljs-number">1</span>) {
        item.like = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        item.like = <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">if</span> (item.watches &amp;&amp; item.watches.indexOf(req.session.userId) &gt; -<span class="hljs-number">1</span>) {
        item.watch = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        item.watch = <span class="hljs-literal">false</span>;
      }
    });
    <span class="hljs-keyword">var</span> body = {};
    body.limit = limit;
    body.skip = skip;
    body.posts = obj;
    req.db.Post.count({}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, total)</span> {</span>
      <span class="hljs-keyword">if</span> (err) next(err);
      body.total = total;
      res.json(<span class="hljs-number">200</span>, body);
    });
  });
};


exports.getPost = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">if</span> (req.params.id) {
    req.db.Post.findById(req.params.id, {
      title: <span class="hljs-literal">true</span>,
      text: <span class="hljs-literal">true</span>,
      url: <span class="hljs-literal">true</span>,
      author: <span class="hljs-literal">true</span>,
      comments: <span class="hljs-literal">true</span>,
      watches: <span class="hljs-literal">true</span>,
      likes: <span class="hljs-literal">true</span>
    }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
      <span class="hljs-keyword">if</span> (err) next(err);
      <span class="hljs-keyword">if</span> (!obj) {
        next(<span class="hljs-string">'Nothing is found.'</span>);
      } <span class="hljs-keyword">else</span> {
        res.json(<span class="hljs-number">200</span>, obj);
      }
    });
  } <span class="hljs-keyword">else</span> {
    next(<span class="hljs-string">'No post id'</span>);
  }
};

exports.del = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  req.db.Post.findById(req.params.id, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (err) next(err);
    <span class="hljs-keyword">if</span> (req.session.admin || req.session.userId === obj.author.id) {
      obj.remove();
      res.json(<span class="hljs-number">200</span>, obj);
    } <span class="hljs-keyword">else</span> {
      next(<span class="hljs-string">'User is not authorized to delete post.'</span>);
    }
  })
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">likePost</span><span class="hljs-params">(req, res, next)</span> {</span>
  req.db.Post.findByIdAndUpdate(req.body._id, {
    $push: {
      likes: req.session.userId
    }
  }, {}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (err) {
      next(err);
    } <span class="hljs-keyword">else</span> {
      res.json(<span class="hljs-number">200</span>, obj);
    }
  });
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">watchPost</span><span class="hljs-params">(req, res, next)</span> {</span>
  req.db.Post.findByIdAndUpdate(req.body._id, {
    $push: {
      watches: req.session.userId
    }
  }, {}, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
    <span class="hljs-keyword">if</span> (err) next(err);
    <span class="hljs-keyword">else</span> {
      res.json(<span class="hljs-number">200</span>, obj);
    }
  });
};

exports.updatePost = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(req, res, next)</span> {</span>
  <span class="hljs-keyword">var</span> anyAction = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">if</span> (req.body._id &amp;&amp; req.params.id) {
    <span class="hljs-keyword">if</span> (req.body &amp;&amp; req.body.action == <span class="hljs-string">'like'</span>) {
      anyAction = <span class="hljs-literal">true</span>;
      likePost(req, res);
    }
    <span class="hljs-keyword">if</span> (req.body &amp;&amp; req.body.action == <span class="hljs-string">'watch'</span>) {
      anyAction = <span class="hljs-literal">true</span>;
      watchPost(req, res);
    }
    <span class="hljs-keyword">if</span> (req.body &amp;&amp; req.body.action == <span class="hljs-string">'comment'</span> &amp;&amp; req.body.comment &amp;&amp; req.params.id) {
      anyAction = <span class="hljs-literal">true</span>;
      req.db.Post.findByIdAndUpdate(req.params.id, {
        $push: {
          comments: {
            author: {
              id: req.session.userId,
              name: req.session.user.displayName
            },
            text: req.body.comment
          }
        }
      }, {
        safe: <span class="hljs-literal">true</span>,
        <span class="hljs-keyword">new</span>: <span class="hljs-literal">true</span>
      }, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, obj)</span> {</span>
        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err;
        res.json(<span class="hljs-number">200</span>, obj);
      });
    }
    <span class="hljs-keyword">if</span> (req.session.auth &amp;&amp; req.session.userId &amp;&amp; req.body &amp;&amp; req.body.action != <span class="hljs-string">'comment'</span> &amp;&amp;
      req.body.action != <span class="hljs-string">'watch'</span> &amp;&amp; req.body != <span class="hljs-string">'like'</span> &amp;&amp;
      req.params.id &amp;&amp; (req.body.author.id == req.session.user._id || req.session.user.admin)) {
      req.db.Post.findById(req.params.id, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err, doc)</span> {</span>
        <span class="hljs-keyword">if</span> (err) next(err);
        doc.title = req.body.title;
        doc.text = req.body.text || <span class="hljs-literal">null</span>;
        doc.url = req.body.url || <span class="hljs-literal">null</span>;
        doc.save(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e, d)</span> {</span>
          <span class="hljs-keyword">if</span> (e) next(e);
          res.json(<span class="hljs-number">200</span>, d);
        });
      })
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (!anyAction) next(<span class="hljs-string">'Something went wrong.'</span>);
    }

  } <span class="hljs-keyword">else</span> {
    next(<span class="hljs-string">'No post ID.'</span>);
  }
};</code></pre>
<h2>Mogoose Models</h2>
<p>Ideally, in a big application, we would break down each model into a separate file. Right now in the HackHall app, we have them all in <code>hackhall/models/index.js</code>.</p>
<p>As always, our dependencies look better at the top:</p>
<pre><code class="javascript hljs "><span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">var</span> Schema = mongoose.Schema;
<span class="hljs-keyword">var</span> roles = <span class="hljs-string">'user staff mentor investor founder'</span>.split(<span class="hljs-string">' '</span>);</code></pre>
<p>The Post model represents post with its likes, comments and watches.</p>
<pre><code class="javascript hljs ">exports.Post = <span class="hljs-keyword">new</span> Schema ({
  title: {
    required: <span class="hljs-literal">true</span>,
    type: <span class="hljs-built_in">String</span>,
    trim: <span class="hljs-literal">true</span>,
    <span class="hljs-comment">// match: /^([[:alpha:][:space:][:punct:]]{1,100})$/</span>
    match: <span class="hljs-regexp">/^([\w ,.!?]{1,100})$/</span>
  },
  url: {
    type: <span class="hljs-built_in">String</span>,
    trim: <span class="hljs-literal">true</span>,
    max: <span class="hljs-number">1000</span>
  },
  text: {
    type: <span class="hljs-built_in">String</span>,
    trim: <span class="hljs-literal">true</span>,
    max: <span class="hljs-number">2000</span>
  },
  comments: [{
    text: {
      type: <span class="hljs-built_in">String</span>,
      trim: <span class="hljs-literal">true</span>,
      max:<span class="hljs-number">2000</span>
    },
    author: {
      id: {
        type: Schema.Types.ObjectId,
        ref: <span class="hljs-string">'User'</span>
      },
      name: <span class="hljs-built_in">String</span>
    }
  }],
  watches: [{
    type: Schema.Types.ObjectId,
    ref: <span class="hljs-string">'User'</span>
  }],
  likes: [{
    type: Schema.Types.ObjectId,
    ref: <span class="hljs-string">'User'</span>
  }],
  author: {
    id: {
      type: Schema.Types.ObjectId,
      ref: <span class="hljs-string">'User'</span>,
      required: <span class="hljs-literal">true</span>
    },
    name: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>
    }
  },
  created: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
    required: <span class="hljs-literal">true</span>
  },
  updated:  {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
    required: <span class="hljs-literal">true</span>
  },
  own: <span class="hljs-built_in">Boolean</span>,
  like: <span class="hljs-built_in">Boolean</span>,
  watch: <span class="hljs-built_in">Boolean</span>,
  admin: <span class="hljs-built_in">Boolean</span>,
  action: <span class="hljs-built_in">String</span>
});</code></pre>
<p>The User model can also serve as an application object (when <code>approved=false</code>):</p>
<pre><code class="javascript hljs ">exports.User = <span class="hljs-keyword">new</span> Schema({
  angelListId: <span class="hljs-built_in">String</span>,
  angelListProfile: Schema.Types.Mixed,
  angelToken: <span class="hljs-built_in">String</span>,
    firstName: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
    trim: <span class="hljs-literal">true</span>
  },
  lastName: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
    trim: <span class="hljs-literal">true</span>
  },
  displayName: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
    trim: <span class="hljs-literal">true</span>
  },
    password: <span class="hljs-built_in">String</span>,
    email: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
    trim: <span class="hljs-literal">true</span>
  },
  role: {
    type:<span class="hljs-built_in">String</span>,
    enum: roles,
    required: <span class="hljs-literal">true</span>,
    <span class="hljs-keyword">default</span>: roles[<span class="hljs-number">0</span>]
  },
  approved: {
    type: <span class="hljs-built_in">Boolean</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-literal">false</span>
  },
  banned: {
    type: <span class="hljs-built_in">Boolean</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-literal">false</span>
  },
  admin: {
    type: <span class="hljs-built_in">Boolean</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-literal">false</span>
  },
  headline: <span class="hljs-built_in">String</span>,
  photoUrl: <span class="hljs-built_in">String</span>,
  angelList: Schema.Types.Mixed,
  created: {
    type: <span class="hljs-built_in">Date</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now
  },
  updated:  {
    type: <span class="hljs-built_in">Date</span>, <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now
  },
  angelUrl: <span class="hljs-built_in">String</span>,
  twitterUrl: <span class="hljs-built_in">String</span>,
  facebookUrl: <span class="hljs-built_in">String</span>,
  linkedinUrl: <span class="hljs-built_in">String</span>,
  githubUrl: <span class="hljs-built_in">String</span>,
  own: <span class="hljs-built_in">Boolean</span>,
  posts: {
    own: [Schema.Types.Mixed],
    likes: [Schema.Types.Mixed],
    watches: [Schema.Types.Mixed],
    comments: [Schema.Types.Mixed]
  }
});</code></pre>
<p>The full source code for <code>hackhall/models/index.js</code>:</p>
<pre markdown="0"><code class="javascript hljs "><span class="hljs-keyword">var</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongoose'</span>);
<span class="hljs-keyword">var</span> Schema = mongoose.Schema;
<span class="hljs-keyword">var</span> roles = <span class="hljs-string">'user staff mentor investor founder'</span>.split(<span class="hljs-string">' '</span>);

exports.Post = <span class="hljs-keyword">new</span> Schema ({
  title: {
    required: <span class="hljs-literal">true</span>,
    type: <span class="hljs-built_in">String</span>,
    trim: <span class="hljs-literal">true</span>,
    <span class="hljs-comment">// match: /^([[:alpha:][:space:][:punct:]]{1,100})$/</span>
    match: <span class="hljs-regexp">/^([\w ,.!?]{1,100})$/</span>
  },
  url: {
    type: <span class="hljs-built_in">String</span>,
    trim: <span class="hljs-literal">true</span>,
    max: <span class="hljs-number">1000</span>
  },
  text: {
    type: <span class="hljs-built_in">String</span>,
    trim: <span class="hljs-literal">true</span>,
    max: <span class="hljs-number">2000</span>
  },
  comments: [{
    text: {
      type: <span class="hljs-built_in">String</span>,
      trim: <span class="hljs-literal">true</span>,
      max:<span class="hljs-number">2000</span>
    },
    author: {
      id: { 
        type: Schema.Types.ObjectId, 
        ref: <span class="hljs-string">'User'</span> 
      },
      name: <span class="hljs-built_in">String</span>
    }
  }],
  watches: [{ 
    type: Schema.Types.ObjectId, 
    ref: <span class="hljs-string">'User'</span> 
  }],
  likes: [{
    type: Schema.Types.ObjectId, 
    ref: <span class="hljs-string">'User'</span>
  }],
  author: {
    id: { 
      type: Schema.Types.ObjectId, 
      ref: <span class="hljs-string">'User'</span>,
      required: <span class="hljs-literal">true</span>
    },
    name: {
      type: <span class="hljs-built_in">String</span>,
      required: <span class="hljs-literal">true</span>
    }
  },
  created: { 
    type: <span class="hljs-built_in">Date</span>, 
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now,
    required: <span class="hljs-literal">true</span>
  },
  updated:  { 
    type: <span class="hljs-built_in">Date</span>, 
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now, 
    required: <span class="hljs-literal">true</span>
  },  
  own: <span class="hljs-built_in">Boolean</span>,
  like: <span class="hljs-built_in">Boolean</span>,
  watch: <span class="hljs-built_in">Boolean</span>,
  admin: <span class="hljs-built_in">Boolean</span>,
  action: <span class="hljs-built_in">String</span>  
});

exports.User = <span class="hljs-keyword">new</span> Schema({
  angelListId: <span class="hljs-built_in">String</span>,
  angelListProfile: Schema.Types.Mixed,
  angelToken: <span class="hljs-built_in">String</span>, 
    firstName: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
    trim: <span class="hljs-literal">true</span>
  },
  lastName: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
    trim: <span class="hljs-literal">true</span>
  },
  displayName: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
    trim: <span class="hljs-literal">true</span>
  },
    password: <span class="hljs-built_in">String</span>,
    email: {
    type: <span class="hljs-built_in">String</span>,
    required: <span class="hljs-literal">true</span>,
    trim: <span class="hljs-literal">true</span>
  },
  role: {
    type:<span class="hljs-built_in">String</span>,
    enum: roles,
    required: <span class="hljs-literal">true</span>,
    <span class="hljs-keyword">default</span>: roles[<span class="hljs-number">0</span>]
  },
  approved: {
    type: <span class="hljs-built_in">Boolean</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-literal">false</span>
  },
  banned: {
    type: <span class="hljs-built_in">Boolean</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-literal">false</span>
  },  
  admin: {
    type: <span class="hljs-built_in">Boolean</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-literal">false</span>
  },  
  headline: <span class="hljs-built_in">String</span>,
  photoUrl: <span class="hljs-built_in">String</span>,
  angelList: Schema.Types.Mixed,
  created: { 
    type: <span class="hljs-built_in">Date</span>, 
    <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now 
  },
  updated:  { 
    type: <span class="hljs-built_in">Date</span>, <span class="hljs-keyword">default</span>: <span class="hljs-built_in">Date</span>.now 
  },
  angelUrl: <span class="hljs-built_in">String</span>,
  twitterUrl: <span class="hljs-built_in">String</span>,
  facebookUrl: <span class="hljs-built_in">String</span>,
  linkedinUrl: <span class="hljs-built_in">String</span>,
  githubUrl: <span class="hljs-built_in">String</span>,
  own: <span class="hljs-built_in">Boolean</span>,
  posts: {
    own: [Schema.Types.Mixed],
    likes: [Schema.Types.Mixed],
    watches: [Schema.Types.Mixed],
    comments: [Schema.Types.Mixed]
  }
});</code></pre>
<h2>Mocha Tests</h2>
<p>One of the benefits of using REST API server architecture is that each route and the application as a whole become very testable. The assurance of the passed tests is a wonderful supplement during development — the so called test-driven development approach.</p>
<p>To run tests, we utilize Makefile:</p>
<pre markdown="0"><code class=" hljs markdown">REPORTER = list
MOCHA_OPTS = --ui tdd --ignore-leaks

test: 
  clear
  echo Starting test <span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span>**
  ./node_modules/mocha/bin/mocha \
  --reporter $(REPORTER) \
  $(MOCHA_OPTS) \
  tests/*.js
  echo Ending test

test-w: 
  ./node_modules/mocha/bin/mocha \
  --reporter $(REPORTER) \
  --growl \
  --watch \
  $(MOCHA_OPTS) \
  tests/*.js 

users: 
  mocha tests/users.js --ui tdd --reporter list --ignore-leaks
  
posts: 
  clear
  echo Starting test <span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span><span class="hljs-strong">*****</span>**
  ./node_modules/mocha/bin/mocha \
  --reporter $(REPORTER) \
  $(MOCHA_OPTS) \
  tests/posts.js 
  echo Ending test

application: 
  mocha tests/application.js --ui tdd --reporter list --ignore-leaks
  
.PHONY: test test-w posts application</code></pre>
<p>Therefore, we can start tests with: <code>$ make</code> command.</p>
<p>All the 20 tests should pass:</p>
<p><img src="./Express.js and Mongoose Example  Building HackHall_files/hackhall-mocha.png" alt="The results of running Mocha tests."></p>
<p>The HackHall tests live in <code>tests</code> folder and consist of:</p>
<ul>
<li><code>hackhall/tests/application.js</code>: functional tests for unapproved users information</li>
<li><code>hackhall/tests/posts.js</code>: functional tests for posts</li>
<li><code>hackhall/tests/users.js</code>: functional tests for users</li>
</ul>
<p>Test use a library called <a href="https://npmjs.org/package/superagent" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-article&#39;,&#39;http://npmjs.org&#39;]);">superagent</a>(<a href="https://github.com/visionmedia/superagent" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-article&#39;,&#39;http://github.com&#39;]);">GitHub</a>).</p>
<p>The full content for <code>hackhall/tests/application.js</code>:</p>
<pre markdown="0"><code class="javascript hljs "><span class="hljs-keyword">var</span> app = <span class="hljs-built_in">require</span> (<span class="hljs-string">'../server'</span>).app,
  assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">'assert'</span>),
  request = <span class="hljs-built_in">require</span>(<span class="hljs-string">'superagent'</span>);

app.listen(app.get(<span class="hljs-string">'port'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
  console.log(<span class="hljs-string">'Express server listening on port '</span> + app.get(<span class="hljs-string">'port'</span>));
});

<span class="hljs-keyword">var</span> user1 = request.agent();
<span class="hljs-keyword">var</span> port = <span class="hljs-string">'http://localhost:'</span>+app.get(<span class="hljs-string">'port'</span>);
<span class="hljs-keyword">var</span> userId;

suite(<span class="hljs-string">'APPLICATION API'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span>{</span>
  suiteSetup(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    done();
  });
  test(<span class="hljs-string">'log in as admin'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.post(port+<span class="hljs-string">'/api/login'</span>).send({email:<span class="hljs-string">'1@1.com'</span>,password:<span class="hljs-string">'1'</span>}).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
        assert.equal(res.status,<span class="hljs-number">200</span>);
      done();
    });       
  });
  test(<span class="hljs-string">'get profile for admin'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.get(port+<span class="hljs-string">'/api/profile'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
        assert.equal(res.status,<span class="hljs-number">200</span>);
      done();
    });
  }); 
  test(<span class="hljs-string">'submit applicaton for user 3@3.com'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.post(port+<span class="hljs-string">'/api/application'</span>).send({
        firstName: <span class="hljs-string">'Dummy'</span>,
      lastName: <span class="hljs-string">'Application'</span>,
      displayName: <span class="hljs-string">'Dummy Application'</span>,
        password: <span class="hljs-string">'3'</span>,
        email: <span class="hljs-string">'3@3.com'</span>,
      headline: <span class="hljs-string">'Dummy Appliation'</span>,
      photoUrl: <span class="hljs-string">'/img/user.png'</span>,
      angelList: {blah:<span class="hljs-string">'blah'</span>},
      angelUrl: <span class="hljs-string">'http://angel.co.com/someuser'</span>,
      twitterUrl: <span class="hljs-string">'http://twitter.com/someuser'</span>,
      facebookUrl: <span class="hljs-string">'http://facebook.com/someuser'</span>,
      linkedinUrl: <span class="hljs-string">'http://linkedin.com/someuser'</span>,
      githubUrl: <span class="hljs-string">'http://github.com/someuser'</span>     
    }).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
      assert.equal(res.status,<span class="hljs-number">200</span>);
      userId = res.body._id;        
      done();
    });
    
  });
  test(<span class="hljs-string">'logout admin'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.post(port+<span class="hljs-string">'/api/logout'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
        assert.equal(res.status,<span class="hljs-number">200</span>);
      done();
    });
  });
  test(<span class="hljs-string">'get profile again after logging out'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.get(port+<span class="hljs-string">'/api/profile'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
        assert.equal(res.status,<span class="hljs-number">500</span>);
      done();
    });
  }); 
  test(<span class="hljs-string">'log in as user3 - unapproved'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.post(port+<span class="hljs-string">'/api/login'</span>).send({email:<span class="hljs-string">'3@3.com'</span>,password:<span class="hljs-string">'3'</span>}).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
        assert.equal(res.status,<span class="hljs-number">200</span>);
      done();
    });       
  }); 
  test(<span class="hljs-string">'get user application'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.get(port+<span class="hljs-string">'/api/application/'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
      <span class="hljs-comment">// console.log(res.body)</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);  
      done();
    });
  }); 
  test(<span class="hljs-string">'update user application'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.put(port+<span class="hljs-string">'/api/application/'</span>).send({      
      firstName: <span class="hljs-string">'boo'</span>}).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
      <span class="hljs-comment">// console.log(res.body)</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);  
      done();
    });
  }); 
  test(<span class="hljs-string">'get user application'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.get(port+<span class="hljs-string">'/api/application/'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
      <span class="hljs-comment">// console.log(res.body)</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);  
      done();
    });
  }); 
  test(<span class="hljs-string">'check for posts - fail (unapproved?)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.get(port+<span class="hljs-string">'/api/posts/'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
      <span class="hljs-comment">// console.log(res.body)</span>
      assert.equal(res.status, <span class="hljs-number">500</span>);
  
      done();
    });
  });
  test(<span class="hljs-string">'logout user'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.post(port+<span class="hljs-string">'/api/logout'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
        assert.equal(res.status,<span class="hljs-number">200</span>);
      done();
    });
  }); 
  test(<span class="hljs-string">'log in as admin'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.post(port+<span class="hljs-string">'/api/login'</span>).send({email:<span class="hljs-string">'1@1.com'</span>,password:<span class="hljs-string">'1'</span>}).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
        assert.equal(res.status,<span class="hljs-number">200</span>);
      done();
    });       
  }); 
  test(<span class="hljs-string">'delete user3'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.del(port+<span class="hljs-string">'/api/users/'</span>+userId).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);
      done();
    });   
  }); 
  test(<span class="hljs-string">'logout admin'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.post(port+<span class="hljs-string">'/api/logout'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
        assert.equal(res.status,<span class="hljs-number">200</span>);
      done();
    });
  }); 
  test(<span class="hljs-string">'log in as user - should fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.post(port+<span class="hljs-string">'/api/login'</span>).send({email:<span class="hljs-string">'3@3.com'</span>,password:<span class="hljs-string">'3'</span>}).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
      <span class="hljs-comment">// console.log(res.body)</span>
        assert.equal(res.status,<span class="hljs-number">500</span>);
      
      done();
    });       
  }); 
  test(<span class="hljs-string">'check for posts - must fail'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    user1.get(port+<span class="hljs-string">'/api/posts/'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span>{</span>
      <span class="hljs-comment">// console.log(res.body)</span>
      assert.equal(res.status, <span class="hljs-number">500</span>);
  
      done();
    });
  }); 
  suiteTeardown(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span>{</span>
    done();
  });

});
</code></pre>
<p>The full content for <code>hackhall/tests/posts.js</code>:</p>
<pre markdown="0"><code class="javascript hljs "><span class="hljs-keyword">var</span> app = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../server'</span>).app,
  assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">'assert'</span>),
  request = <span class="hljs-built_in">require</span>(<span class="hljs-string">'superagent'</span>);

app.listen(app.get(<span class="hljs-string">'port'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  console.log(<span class="hljs-string">'Express server listening on port '</span> + app.get(<span class="hljs-string">'port'</span>));
});

<span class="hljs-keyword">var</span> user1 = request.agent();
<span class="hljs-keyword">var</span> port = <span class="hljs-string">'http://localhost:'</span> + app.get(<span class="hljs-string">'port'</span>);
<span class="hljs-keyword">var</span> postId;

suite(<span class="hljs-string">'POSTS API'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  suiteSetup(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    done();
  });
  test(<span class="hljs-string">'log in'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    user1.post(port + <span class="hljs-string">'/api/login'</span>).send({
      email: <span class="hljs-string">'1@1.com'</span>,
      password: <span class="hljs-string">'1'</span>
    }).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);
      done();
    });
  });
  test(<span class="hljs-string">'add post'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    user1.post(port + <span class="hljs-string">'/api/posts'</span>).send({
      title: <span class="hljs-string">'Yo Test Title'</span>,
      text: <span class="hljs-string">'Yo Test text'</span>,
      url: <span class="hljs-string">''</span>
    }).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);
      postId = res.body._id;
      done();
    });

  });
  test(<span class="hljs-string">'get profile'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    user1.get(port + <span class="hljs-string">'/api/profile'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);
      done();
    });
  });
  test(<span class="hljs-string">'post get'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    <span class="hljs-comment">// console.log('000'+postId);</span>
    user1.get(port + <span class="hljs-string">'/api/posts/'</span> + postId).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);
      assert.equal(res.body._id, postId);
      done();
    });
  });
  test(<span class="hljs-string">'delete post'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    user1.del(port + <span class="hljs-string">'/api/posts/'</span> + postId).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);
      done();
    });
  });
  test(<span class="hljs-string">'check for deleted post'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    user1.get(port + <span class="hljs-string">'/api/posts/'</span> + postId).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      <span class="hljs-comment">// console.log(res.body)</span>
      assert.equal(res.status, <span class="hljs-number">500</span>);

      done();
    });
  });
  suiteTeardown(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    done();
  });

});</code></pre>
<p>The full content for <code>hackhall/tests/users.js</code>:</p>
<pre markdown="0"><code class="javascript hljs "><span class="hljs-keyword">var</span> app = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../server'</span>).app,
  assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">'assert'</span>),
  request = <span class="hljs-built_in">require</span>(<span class="hljs-string">'superagent'</span>);
<span class="hljs-comment">// http = require('support/http');</span>

<span class="hljs-keyword">var</span> user1 = request.agent();
<span class="hljs-keyword">var</span> port = <span class="hljs-string">'http://localhost:'</span> + app.get(<span class="hljs-string">'port'</span>);


app.listen(app.get(<span class="hljs-string">'port'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  console.log(<span class="hljs-string">'Express server listening on port '</span> + app.get(<span class="hljs-string">'port'</span>));
});

suite(<span class="hljs-string">'Test root'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  setup(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    console.log(<span class="hljs-string">'setup'</span>);

    done();
  });

  test(<span class="hljs-string">'check /'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    request.get(<span class="hljs-string">'http://localhost:3000'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);
      done();
    });
  });
  test(<span class="hljs-string">'check /api/profile'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    request.get(<span class="hljs-string">'http://localhost:'</span> + app.get(<span class="hljs-string">'port'</span>) + <span class="hljs-string">'/api/profile'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">500</span>);
      done();
    });
  });
  test(<span class="hljs-string">'check /api/users'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    user1.get(<span class="hljs-string">'http://localhost:'</span> + app.get(<span class="hljs-string">'port'</span>) + <span class="hljs-string">'/api/users'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">500</span>);
      <span class="hljs-comment">// console.log(res.text.length);</span>
      done();
    });
    <span class="hljs-comment">// done();</span>
  });
  test(<span class="hljs-string">'check /api/posts'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    user1.get(<span class="hljs-string">'http://localhost:'</span> + app.get(<span class="hljs-string">'port'</span>) + <span class="hljs-string">'/api/posts'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">500</span>);
      <span class="hljs-comment">// console.log(res.text.length);</span>
      done();
    });
    <span class="hljs-comment">// done();</span>
  });
  teardown(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    console.log(<span class="hljs-string">'teardown'</span>);
    done();
  });

});

suite(<span class="hljs-string">'Test log in'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  setup(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    console.log(<span class="hljs-string">'setup'</span>);

    done();
  });
  test(<span class="hljs-string">'login'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    user1.post(<span class="hljs-string">'http://localhost:3000/api/login'</span>).send({
      email: <span class="hljs-string">'1@1.com'</span>,
      password: <span class="hljs-string">'1'</span>
    }).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);
      done();
    });

  });
  test(<span class="hljs-string">'check /api/profile'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    user1.get(<span class="hljs-string">'http://localhost:'</span> + app.get(<span class="hljs-string">'port'</span>) + <span class="hljs-string">'/api/profile'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);
      <span class="hljs-comment">// console.log(res.text.length);</span>
      done();
    });
    <span class="hljs-comment">// done();</span>
  });
  test(<span class="hljs-string">'check /api/users'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    user1.get(<span class="hljs-string">'http://localhost:'</span> + app.get(<span class="hljs-string">'port'</span>) + <span class="hljs-string">'/api/users'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);
      <span class="hljs-comment">// console.log(res.text);</span>
      done();
    });
    <span class="hljs-comment">// done();</span>
  });
  test(<span class="hljs-string">'check /api/posts'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    user1.get(<span class="hljs-string">'http://localhost:'</span> + app.get(<span class="hljs-string">'port'</span>) + <span class="hljs-string">'/api/posts'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);
      <span class="hljs-comment">// console.log(res.text.length);</span>
      done();
    });
    <span class="hljs-comment">// done();</span>
  });

  teardown(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    console.log(<span class="hljs-string">'teardown'</span>);
    done();
  });

});
suite(<span class="hljs-string">'User control'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-keyword">var</span> user2 = {
    firstName: <span class="hljs-string">'Bob'</span>,
    lastName: <span class="hljs-string">'Dilan'</span>,
    displayName: <span class="hljs-string">'Bob Dilan'</span>,
    email: <span class="hljs-string">'2@2.com'</span>
  };
  suiteSetup(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    user1.post(<span class="hljs-string">'http://localhost:3000/api/login'</span>).send({
      email: <span class="hljs-string">'1@1.com'</span>,
      password: <span class="hljs-string">'1'</span>
    }).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);
      <span class="hljs-comment">// done();</span>
    });
    user1.get(<span class="hljs-string">'http://localhost:'</span> + app.get(<span class="hljs-string">'port'</span>) + <span class="hljs-string">'/api/profile'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);
      <span class="hljs-comment">// console.log(res.text.length);</span>
      <span class="hljs-comment">// done();</span>
    });

    done();
  })

  test(<span class="hljs-string">'new user POST /api/users'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    user1.post(port + <span class="hljs-string">'/api/users'</span>)
      .send(user2)
      .end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
        assert.equal(res.status, <span class="hljs-number">200</span>);
        <span class="hljs-comment">// console.log(res.text.length);</span>
        user2 = res.body;
        <span class="hljs-comment">// console.log(user2)</span>
        done();
      })
  });
  test(<span class="hljs-string">'get user list and check for new user GET /api/users'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    user1.get(<span class="hljs-string">'http://localhost:'</span> + app.get(<span class="hljs-string">'port'</span>) + <span class="hljs-string">'/api/users'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
      assert.equal(res.status, <span class="hljs-number">200</span>);
      <span class="hljs-comment">// console.log(res.body)</span>
      <span class="hljs-keyword">var</span> user3 = res.body.filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el, i, list)</span> {</span>
        <span class="hljs-keyword">return</span> (el._id == user2._id);
      });
      assert(user3.length === <span class="hljs-number">1</span>);
      <span class="hljs-comment">// assert(res.body.indexOf(user2)&gt;-1);</span>
      <span class="hljs-comment">// console.log(res.body.length)</span>
      done();
    })
  });
  test(<span class="hljs-string">'Approve User: PUT /api/users/'</span> + user2._id, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    assert(user2._id != <span class="hljs-string">''</span>);
    user1.put(port + <span class="hljs-string">'/api/users/'</span> + user2._id)
      .send({
        approved: <span class="hljs-literal">true</span>
      })
      .end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
        assert.equal(res.status, <span class="hljs-number">200</span>);
        <span class="hljs-comment">// console.log(res.text.length);</span>
        assert(res.body.approved);
        user1.get(port + <span class="hljs-string">'/api/users/'</span> + user2._id).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
          assert(res.status, <span class="hljs-number">200</span>);
          assert(res.body.approved);
          done();
        })

      })
  });
  test(<span class="hljs-string">'Banned User: PUT /api/users/'</span> + user2._id, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    assert(user2._id != <span class="hljs-string">''</span>);
    user1.put(port + <span class="hljs-string">'/api/users/'</span> + user2._id)
      .send({
        banned: <span class="hljs-literal">true</span>
      })
      .end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
        assert.equal(res.status, <span class="hljs-number">200</span>);
        <span class="hljs-comment">// console.log(res.text.length);</span>
        assert(res.body.banned);
        user1.get(port + <span class="hljs-string">'/api/users/'</span> + user2._id).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
          assert(res.status, <span class="hljs-number">200</span>);
          assert(res.body.banned);
          done();
        })

      })
  });
  test(<span class="hljs-string">'Promote User: PUT /api/users/'</span> + user2._id, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    assert(user2._id != <span class="hljs-string">''</span>);
    user1.put(port + <span class="hljs-string">'/api/users/'</span> + user2._id)
      .send({
        admin: <span class="hljs-literal">true</span>
      })
      .end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
        assert.equal(res.status, <span class="hljs-number">200</span>);
        <span class="hljs-comment">// console.log(res.text.length);</span>
        assert(res.body.admin);
        user1.get(port + <span class="hljs-string">'/api/users/'</span> + user2._id).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
          assert(res.status, <span class="hljs-number">200</span>);
          assert(res.body.admin);
          done();
        })

      })
  });
  test(<span class="hljs-string">'Delete User: DELETE /api/users/:id'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {</span>
    assert(user2._id != <span class="hljs-string">''</span>);
    user1.del(port + <span class="hljs-string">'/api/users/'</span> + user2._id)
      .end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
        assert.equal(res.status, <span class="hljs-number">200</span>);
        <span class="hljs-comment">// console.log('id:' + user2._id)</span>
        user1.get(port + <span class="hljs-string">'/api/users'</span>).end(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
          assert.equal(res.status, <span class="hljs-number">200</span>);
          <span class="hljs-keyword">var</span> user3 = res.body.filter(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el, i, list)</span> {</span>
            <span class="hljs-keyword">return</span> (el._id === user2._id);
          });
          <span class="hljs-comment">// console.log('***');</span>
          <span class="hljs-comment">// console.warn(user3);</span>
          assert(user3.length === <span class="hljs-number">0</span>);
          done();
        });
      });


  });
});
<span class="hljs-comment">// app.close();   </span>
<span class="hljs-comment">// console.log(app)</span></code></pre>
<p><b>Warning:</b> Please don’t store plain passwords/keys in the database. Any serious production app should at least <a href="https://crackstation.net/hashing-security.htm" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-article&#39;,&#39;http://crackstation.net&#39;]);">salt the passwords</a> before storing them.</p>
<h2>Conclusion</h2>
<p>HackHall is still in development, but there are important real production applications components, such as REST API architecture, OAuth, Mongoose and its models, MVC structure of Express.js apps, access to environment variables, etc.</p>
<div class="dd_post_share"><div class="dd_buttons"><div class="dd_button"><iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" src="./Express.js and Mongoose Example  Building HackHall_files/tweet_button.1395870373.html" class="twitter-share-button twitter-tweet-button twitter-count-vertical" title="Twitter Tweet Button" data-twttr-rendered="true" style="width: 56px; height: 62px;"></iframe><script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/widgets(1).js"></script></div><div class="dd_button"><iframe src="./Express.js and Mongoose Example  Building HackHall_files/button2.html" height="69" width="51" scrolling="no" frameborder="0"></iframe></div><div class="dd_button"><script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/button.js"></script><iframe scrolling="no" frameborder="0" class="buffer-button" src="./Express.js and Mongoose Example  Building HackHall_files/saved_resource(2).html" style="border: none; width: 55px; height: 62px;"></iframe></div><div class="dd_button"><script src="./Express.js and Mongoose Example  Building HackHall_files/hostedbadge.php"></script><iframe scrolling="no" frameborder="0" allowtransparency="true" src="./Express.js and Mongoose Example  Building HackHall_files/saved_resource.html" width="50" height="60" id="iframe-stmblpn-widget-1" style="overflow: hidden; margin: 0px; padding: 0px; border: 0px;"></iframe> <script type="text/javascript">   (function() {     var li = document.createElement('script'); li.type = 'text/javascript'; li.async = true;     li.src = window.location.protocol + '//platform.stumbleupon.com/1/widgets.js';     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(li, s);   })(); </script></div><div class="dd_button"><script src="./Express.js and Mongoose Example  Building HackHall_files/all.js"></script><fb:like href="http://webapplog.com/express-js-and-mongoose-example-building-hackhall/" send="false" show_faces="false" layout="button_count" width="92" class=" fb_iframe_widget" fb-xfbml-state="rendered" fb-iframe-plugin-query="app_id=&amp;href=http%3A%2F%2Fwebapplog.com%2Fexpress-js-and-mongoose-example-building-hackhall%2F&amp;layout=button_count&amp;locale=en_US&amp;sdk=joey&amp;send=false&amp;show_faces=false&amp;width=92"><span style="vertical-align: top; width: 0px; height: 0px;"><iframe name="f14ae72928" width="92px" height="1000px" frameborder="0" allowtransparency="true" scrolling="no" title="fb:like Facebook Social Plugin" src="./Express.js and Mongoose Example  Building HackHall_files/like.html" style="border: none; visibility: visible; width: 0px; height: 0px;"></iframe></span></fb:like></div><div class="dd_button"><script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/plusone.js" gapi_processed="true"></script><div id="___plusone_0" style="text-indent: 0px; margin: 0px; padding: 0px; background-color: transparent; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 50px; height: 60px; background-position: initial initial; background-repeat: initial initial;"><iframe frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="position: static; top: 0px; width: 50px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 60px;" tabindex="0" vspace="0" width="100%" id="I0_1396743076752" name="I0_1396743076752" src="./Express.js and Mongoose Example  Building HackHall_files/fastbutton.html" data-gapiattached="true" title="+1"></iframe></div></div><div class="dd_button"><a name="fb_share" type="box_count" share_url="http://webapplog.com/express-js-and-mongoose-example-building-hackhall/" href="http://www.facebook.com/sharer.php" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-article&#39;,&#39;http://www.facebook.com&#39;]);"></a><script src="./Express.js and Mongoose Example  Building HackHall_files/FB.Share" type="text/javascript"></script></div><div class="dd_button"><script src="./Express.js and Mongoose Example  Building HackHall_files/in.js" type="text/javascript"></script><span class="IN-widget" style="line-height: 1; vertical-align: baseline; display: inline-block; text-align: center;"><span style="padding: 0px !important; margin: 0px !important; text-indent: 0px !important; display: inline-block !important; vertical-align: baseline !important; font-size: 1px !important;"><span id="li_ui_li_gen_1396743077009_1-container" class="IN-top"><span id="li_ui_li_gen_1396743077009_1" class="IN-top"><span id="li_ui_li_gen_1396743077009_1-inner" class="IN-top"><span id="li_ui_li_gen_1396743077009_1-content" class="IN-top">4</span></span></span></span></span><br><span style="padding: 0px !important; margin: 0px !important; text-indent: 0px !important; display: inline-block !important; vertical-align: baseline !important; font-size: 1px !important;"><span id="li_ui_li_gen_1396743077000_0"><a id="li_ui_li_gen_1396743077000_0-link" href="javascript:void(0);"><span id="li_ui_li_gen_1396743077000_0-logo">in</span><span id="li_ui_li_gen_1396743077000_0-title"><span id="li_ui_li_gen_1396743077000_0-mark"></span><span id="li_ui_li_gen_1396743077000_0-title-text">Share</span></span></a></span></span></span><script type="IN/Share+init" data-url="http://webapplog.com/express-js-and-mongoose-example-building-hackhall/" data-counter="top"></script></div><div class="dd_button"><div class="pocket-btn"><iframe width="60" height="63" id="pocket-button-0" frameborder="0" allowtransparency="true" scrolling="NO" src="./Express.js and Mongoose Example  Building HackHall_files/button.html"></iframe></div><script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script></div></div><div style="clear:both"></div></div><!-- Social Buttons Generated by Digg Digg plugin v5.3.6,
    Author : Buffer, Inc
    Website : http://bufferapp.com/diggdigg -->					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="http://webapplog.com/category/book-2/" title="View all posts in Book" rel="category tag">Book</a>, <a href="http://webapplog.com/category/mongodb/" title="View all posts in MongoDB" rel="category tag">MongoDB</a>, <a href="http://webapplog.com/category/node-js-2/" title="View all posts in Node.js" rel="category tag">Node.js</a>, <a href="http://webapplog.com/category/startups/" title="View all posts in Startups" rel="category tag">Startups</a>, <a href="http://webapplog.com/category/tutorials/" title="View all posts in Tutorials" rel="category tag">Tutorials</a> and tagged <a href="http://webapplog.com/tag/express-js/" rel="tag">express.js</a>, <a href="http://webapplog.com/tag/expressjs/" rel="tag">expressjs</a>, <a href="http://webapplog.com/tag/hackhall/" rel="tag">hackhall</a>, <a href="http://webapplog.com/tag/mongodb/" rel="tag">MongoDB</a>, <a href="http://webapplog.com/tag/node-js/" rel="tag">node.js</a>, <a href="http://webapplog.com/tag/rest-api/" rel="tag">rest api</a> on <a href="./Express.js and Mongoose Example  Building HackHall_files/Express.js and Mongoose Example  Building HackHall.html" title="12:07 pm" rel="bookmark"><time class="entry-date" datetime="2013-11-05T12:07:11+00:00">November 5, 2013</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="http://webapplog.com/author/admin/" title="View all posts by Azat" rel="author">Azat</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

				<nav class="nav-single">
					<h3 class="assistive-text">Post navigation</h3>
					<span class="nav-previous"><a href="http://webapplog.com/qa-imagemagick-and-code-organization-in-express-js/" rel="prev"><span class="meta-nav">←</span> Q&amp;A: ImageMagick and Code Organization in Express.js</a></span>
					<span class="nav-next"><a href="http://webapplog.com/emoji-in-github-commit-messages/" rel="next">Emoji in GitHub Commit Messages <span class="meta-nav">→</span></a></span>
				</nav><!-- .nav-single -->

				
<div id="comments" class="comments-area">

	
			<h2 class="comments-title">
			One thought on “<span>Express.js and Mongoose Example: Building HackHall</span>”		</h2>

		<ol class="commentlist">
				<li class="pingback even thread-even depth-1" id="comment-1175">
		<p>Pingback: <a href="http://soshitech.com/2013/12/07/javascript-hacks-for-hipsters/" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-commentauthor&#39;,&#39;http://soshitech.com&#39;]);" rel="external nofollow" class="url">Javascript Hacks for Hipsters | SoshiTech</a> </p>
	</li><!-- #comment-## -->
		</ol><!-- .commentlist -->

		
		
	
									<div id="respond" class="comment-respond">
				<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="http://webapplog.com/express-js-and-mongoose-example-building-hackhall/#respond" style="display:none;">Cancel reply</a></small></h3>
									<form action="http://webapplog.com/wp-comments-post.php" method="post" id="commentform" class="comment-form">
																			<p class="comment-notes">Your email address will not be published. Required fields are marked <span class="required">*</span></p>							<p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" aria-required="true"></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" aria-required="true"></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30"></p>
												<p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" aria-required="true"></textarea></p>						<p class="form-allowed-tags">You may use these <abbr title="HyperText Markup Language">HTML</abbr> tags and attributes:  <code>&lt;a href="" title=""&gt; &lt;abbr title=""&gt; &lt;acronym title=""&gt; &lt;b&gt; &lt;blockquote cite=""&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=""&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=""&gt; &lt;strike&gt; &lt;strong&gt; </code></p>						<p class="form-submit">
							<input name="submit" type="submit" id="submit" value="Post Comment">
							<input type="hidden" name="comment_post_ID" value="1297" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
						</p>
						<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="a1bfcf1ebc"></p><p class="tgm-mc-subscribe" style="clear: both;"><input type="checkbox" name="tgm_mc_get_subscribed" id="tgm-mc-get-subscribed" value="subscribe" style="width: auto;"><label for="tgm_mc_get_subscribed"> Subscribe me to your mailing list</label></p>					</form>
							</div><!-- #respond -->
			        <script type="text/javascript">
            jQuery(document).ready(function () {
                jQuery('#commentform').submit(function () {
                    _gaq.push(
                            ['_setAccount', 'UA-31400044-1'],
                            ['_trackEvent', 'comment', 'submit']
                    );
                });
            });
        </script>
		
</div><!-- #comments .comments-area -->
			
		</div><!-- #content -->
	</div><!-- #primary -->


			<div id="secondary" class="widget-area" role="complementary">
			<aside id="text-7" class="widget widget_text"><h3 class="widget-title">Goodbye Express.js Guide Sale</h3>			<div class="textwidget"><div><a href="https://leanpub.com/b/goodbyeexpressjsguide" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-widget&#39;,&#39;http://leanpub.com&#39;]);"><img src="./Express.js and Mongoose Example  Building HackHall_files/expressjs-guide-the-comprehensive-book-on-expressjs.png" width="200" title="Express.js Guide: The Comprehensive Book on Express.js."></a>Goodbye Express.js Guide Sale: 4 Books For Only $19.99 (reg. $84.97)<br>
<a style="text-align:center; width: 200px;
display: block;
text-decoration: none;
font-family: &#39;Open Sans&#39;;" href="https://leanpub.com/b/goodbyeexpressjsguide" class="gumroad-button" id="buygumroad">LEARN MORE</a><br>
 <a href="http://expressjsguide.com/?utm_source=wal_learnmore" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-widget&#39;,&#39;http://expressjsguide.com?utm_source=wal_learnmore&#39;]);"></a>
</div></div>
		</aside><aside id="text-3" class="widget widget_text"><h3 class="widget-title">About Me</h3>			<div class="textwidget"><figure>
<img src="./Express.js and Mongoose Example  Building HackHall_files/azat.jpg" alt="Azat Mardanov" width="200">
<figcaption><h1>Azat Mardanov</h1></figcaption>
</figure>A software engineer, an author and a yogi. Azat likes NodeJS, JavaScript, MongoDB, Ruby on Rails, PHP and SQL. <a href="http://500.co/" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-widget&#39;,&#39;http://500.co&#39;]);">500 Startups</a> alumnus.<br><br>
More info at <a href="http://azat.co/" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-widget&#39;,&#39;http://azat.co&#39;]);">http://azat.co</a> and<br>
<a href="http://github.com/azat-co" onclick="javascript:_gaq.push([&#39;_trackEvent&#39;,&#39;outbound-widget&#39;,&#39;http://github.com&#39;]);">github.com/azat-co</a></div>
		</aside><aside id="tag_cloud-4" class="widget widget_tag_cloud"><h3 class="widget-title">Tags</h3><div class="tagcloud"><a href="http://webapplog.com/tag/backbone/" class="tag-link-23" title="2 topics" style="font-size: 8pt;">Backbone</a>
<a href="http://webapplog.com/tag/backbone-js/" class="tag-link-159" title="2 topics" style="font-size: 8pt;">backbone.js</a>
<a href="http://webapplog.com/tag/book/" class="tag-link-67" title="2 topics" style="font-size: 8pt;">book</a>
<a href="http://webapplog.com/tag/coffeescript/" class="tag-link-125" title="2 topics" style="font-size: 8pt;">CoffeeScript</a>
<a href="http://webapplog.com/tag/education-2/" class="tag-link-49" title="2 topics" style="font-size: 8pt;">education</a>
<a href="http://webapplog.com/tag/express-js/" class="tag-link-164" title="11 topics" style="font-size: 15.6363636364pt;">express.js</a>
<a href="http://webapplog.com/tag/express-js-guide/" class="tag-link-235" title="3 topics" style="font-size: 9.52727272727pt;">express.js guide</a>
<a href="http://webapplog.com/tag/expressjs/" class="tag-link-234" title="6 topics" style="font-size: 12.7090909091pt;">expressjs</a>
<a href="http://webapplog.com/tag/git/" class="tag-link-121" title="2 topics" style="font-size: 8pt;">Git</a>
<a href="http://webapplog.com/tag/hack/" class="tag-link-144" title="4 topics" style="font-size: 10.8pt;">hack</a>
<a href="http://webapplog.com/tag/hackathon/" class="tag-link-15" title="8 topics" style="font-size: 13.9818181818pt;">hackathon</a>
<a href="http://webapplog.com/tag/heroku/" class="tag-link-36" title="2 topics" style="font-size: 8pt;">Heroku</a>
<a href="http://webapplog.com/tag/intro-to-express-js/" class="tag-link-167" title="4 topics" style="font-size: 10.8pt;">intro to express.js</a>
<a href="http://webapplog.com/tag/javascript/" class="tag-link-7" title="28 topics" style="font-size: 20.4727272727pt;">JavaScript</a>
<a href="http://webapplog.com/tag/jquery/" class="tag-link-21" title="4 topics" style="font-size: 10.8pt;">jQuery</a>
<a href="http://webapplog.com/tag/js/" class="tag-link-81" title="5 topics" style="font-size: 11.8181818182pt;">js</a>
<a href="http://webapplog.com/tag/leanpub/" class="tag-link-203" title="2 topics" style="font-size: 8pt;">leanpub</a>
<a href="http://webapplog.com/tag/lean-startup-2/" class="tag-link-58" title="2 topics" style="font-size: 8pt;">lean startup</a>
<a href="http://webapplog.com/tag/mac/" class="tag-link-109" title="2 topics" style="font-size: 8pt;">mac</a>
<a href="http://webapplog.com/tag/markdown/" class="tag-link-62" title="3 topics" style="font-size: 9.52727272727pt;">markdown</a>
<a href="http://webapplog.com/tag/middleware/" class="tag-link-192" title="2 topics" style="font-size: 8pt;">middleware</a>
<a href="http://webapplog.com/tag/mocha/" class="tag-link-151" title="2 topics" style="font-size: 8pt;">mocha</a>
<a href="http://webapplog.com/tag/mongo/" class="tag-link-80" title="3 topics" style="font-size: 9.52727272727pt;">mongo</a>
<a href="http://webapplog.com/tag/mongodb/" class="tag-link-35" title="11 topics" style="font-size: 15.6363636364pt;">MongoDB</a>
<a href="http://webapplog.com/tag/monk/" class="tag-link-98" title="2 topics" style="font-size: 8pt;">monk</a>
<a href="http://webapplog.com/tag/node/" class="tag-link-34" title="15 topics" style="font-size: 17.1636363636pt;">Node</a>
<a href="http://webapplog.com/tag/node-js/" class="tag-link-51" title="37 topics" style="font-size: 22pt;">node.js</a>
<a href="http://webapplog.com/tag/nodejs/" class="tag-link-22" title="9 topics" style="font-size: 14.6181818182pt;">NodeJS</a>
<a href="http://webapplog.com/tag/perl/" class="tag-link-4" title="2 topics" style="font-size: 8pt;">Perl</a>
<a href="http://webapplog.com/tag/php/" class="tag-link-11" title="6 topics" style="font-size: 12.7090909091pt;">PHP</a>
<a href="http://webapplog.com/tag/programming/" class="tag-link-204" title="3 topics" style="font-size: 9.52727272727pt;">programming</a>
<a href="http://webapplog.com/tag/rackspace/" class="tag-link-168" title="2 topics" style="font-size: 8pt;">rackspace</a>
<a href="http://webapplog.com/tag/rapid-prototyping/" class="tag-link-68" title="2 topics" style="font-size: 8pt;">rapid prototyping</a>
<a href="http://webapplog.com/tag/rapid-prototyping-with-js/" class="tag-link-69" title="5 topics" style="font-size: 11.8181818182pt;">rapid prototyping with js</a>
<a href="http://webapplog.com/tag/social-media-2/" class="tag-link-92" title="2 topics" style="font-size: 8pt;">social media</a>
<a href="http://webapplog.com/tag/startup/" class="tag-link-139" title="4 topics" style="font-size: 10.8pt;">startup</a>
<a href="http://webapplog.com/tag/startupbus/" class="tag-link-140" title="7 topics" style="font-size: 13.3454545455pt;">startupbus</a>
<a href="http://webapplog.com/tag/startupbus-2013/" class="tag-link-141" title="7 topics" style="font-size: 13.3454545455pt;">startupbus 2013</a>
<a href="http://webapplog.com/tag/startups/" class="tag-link-14" title="8 topics" style="font-size: 13.9818181818pt;">Startups</a>
<a href="http://webapplog.com/tag/storify/" class="tag-link-70" title="3 topics" style="font-size: 9.52727272727pt;">Storify</a>
<a href="http://webapplog.com/tag/superagent/" class="tag-link-157" title="2 topics" style="font-size: 8pt;">superagent</a>
<a href="http://webapplog.com/tag/sxsw/" class="tag-link-143" title="4 topics" style="font-size: 10.8pt;">sxsw</a>
<a href="http://webapplog.com/tag/thestartupbus/" class="tag-link-142" title="4 topics" style="font-size: 10.8pt;">thestartupbus</a>
<a href="http://webapplog.com/tag/twitter/" class="tag-link-94" title="2 topics" style="font-size: 8pt;">twitter</a>
<a href="http://webapplog.com/tag/twitter-api/" class="tag-link-101" title="2 topics" style="font-size: 8pt;">twitter api</a></div>
</aside><aside id="categories-3" class="widget widget_categories"><h3 class="widget-title">Categories</h3><select name="cat" id="cat" class="postform">
	<option value="-1">Select Category</option>
	<option class="level-0" value="59">Advices&nbsp;&nbsp;(27)</option>
	<option class="level-0" value="74">Book&nbsp;&nbsp;(18)</option>
	<option class="level-0" value="125">CoffeeScript&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="32">Education&nbsp;&nbsp;(16)</option>
	<option class="level-0" value="6">Freelance&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="19">GitHub&nbsp;&nbsp;(2)</option>
	<option class="level-0" value="275">Growth Hacking&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="15">hackathon&nbsp;&nbsp;(9)</option>
	<option class="level-0" value="7">JavaScript&nbsp;&nbsp;(34)</option>
	<option class="level-0" value="53">Lean Startup&nbsp;&nbsp;(2)</option>
	<option class="level-0" value="111">Mobile&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="35">MongoDB&nbsp;&nbsp;(8)</option>
	<option class="level-0" value="97">Node.js&nbsp;&nbsp;(34)</option>
	<option class="level-0" value="4">Perl&nbsp;&nbsp;(2)</option>
	<option class="level-0" value="90">Personal&nbsp;&nbsp;(13)</option>
	<option class="level-0" value="11">PHP&nbsp;&nbsp;(5)</option>
	<option class="level-0" value="73">Rapid Prototyping with JS&nbsp;&nbsp;(6)</option>
	<option class="level-0" value="54">Review&nbsp;&nbsp;(5)</option>
	<option class="level-0" value="91">Social Media&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="52">StartupMonthly&nbsp;&nbsp;(2)</option>
	<option class="level-0" value="14">Startups&nbsp;&nbsp;(48)</option>
	<option class="level-0" value="79">Storify&nbsp;&nbsp;(8)</option>
	<option class="level-0" value="37">Tutorials&nbsp;&nbsp;(25)</option>
	<option class="level-0" value="1">Uncategorized&nbsp;&nbsp;(1)</option>
	<option class="level-0" value="72">Work&nbsp;&nbsp;(6)</option>
</select>

<script type="text/javascript">
/* <![CDATA[ */
	var dropdown = document.getElementById("cat");
	function onCatChange() {
		if ( dropdown.options[dropdown.selectedIndex].value > 0 ) {
			location.href = "http://webapplog.com/?cat="+dropdown.options[dropdown.selectedIndex].value;
		}
	}
	dropdown.onchange = onCatChange;
/* ]]> */
</script>

</aside>		<aside id="recent-posts-3" class="widget widget_recent_entries">		<h3 class="widget-title">Recent Posts</h3>		<ul>
					<li>
				<a href="http://webapplog.com/growth-hacking-the-new-docusign-experience/">Growth Hacking The New DocuSign Experience</a>
						</li>
					<li>
				<a href="http://webapplog.com/getting-published-as-a-programmer-the-practical-node-js-story/">Getting Published as a Programmer: The Practical Node.js Story</a>
						</li>
					<li>
				<a href="http://webapplog.com/what-is-growth-hacking/">What is Growth Hacking</a>
						</li>
					<li>
				<a href="http://webapplog.com/pre-order-practical-node-js-and-buy-alpha/">Pre-Order Practical Node.js and Buy Alpha!</a>
						</li>
					<li>
				<a href="http://webapplog.com/express-js-guide-goes-to-apress/">Express.js Guide Goes to Apress</a>
						</li>
					<li>
				<a href="http://webapplog.com/how-to-stay-healthy-and-sane-working-12-hour-days-as-a-programmer/">How to Stay Healthy and Sane Working 12-hour Days As a Programmer</a>
						</li>
					<li>
				<a href="http://webapplog.com/express-js-guide-re-publish/">Express.js Guide Might Be Retired and Re-Published Traditionally</a>
						</li>
					<li>
				<a href="http://webapplog.com/succeeding-with-agile-brief-overview-i/">Succeeding with Agile, Brief Overview I</a>
						</li>
					<li>
				<a href="http://webapplog.com/new-node-js-frameworks/">New Node.js Frameworks</a>
						</li>
					<li>
				<a href="http://webapplog.com/programmers-are-assholes/">Programmers Are Assholes?</a>
						</li>
					<li>
				<a href="http://webapplog.com/node-js-express-101/">Node.js &amp; Express 101</a>
						</li>
					<li>
				<a href="http://webapplog.com/invest-in-yourself/">Invest in Yourself</a>
						</li>
					<li>
				<a href="http://webapplog.com/blog-express-js-web-application-example/">Blog Express.js Web Application Example</a>
						</li>
					<li>
				<a href="http://webapplog.com/full-stack-software-engineer-position-at-docusign/">Full-Stack Software Engineer Position at DocuSign</a>
						</li>
					<li>
				<a href="http://webapplog.com/get-your-programming-questions-answered/">Get Your Programming Questions Answered</a>
						</li>
					<li>
				<a href="http://webapplog.com/56-off-on-four-javascript-and-node-books-during-holidays/">56% off on Four JavaScript and Node Books During Holidays!</a>
						</li>
					<li>
				<a href="http://webapplog.com/node-js-fundamentals-a-concise-overview-of-the-main-concepts/">Node.js FUNdamentals: A Concise Overview of The Main Concepts</a>
						</li>
					<li>
				<a href="http://webapplog.com/breaking-bad-loops-in-javascript-libraries/">Breaking Bad (Loops in JavaScript Libraries)</a>
						</li>
					<li>
				<a href="http://webapplog.com/understanding-fat-arrows-in-coffeescript/">Understanding Fat Arrows (=&gt;) in CoffeeScript</a>
						</li>
					<li>
				<a href="http://webapplog.com/emoji-in-github-commit-messages/">Emoji in GitHub Commit Messages</a>
						</li>
					<li>
				<a href="./Express.js and Mongoose Example  Building HackHall_files/Express.js and Mongoose Example  Building HackHall.html">Express.js and Mongoose Example: Building HackHall</a>
						</li>
					<li>
				<a href="http://webapplog.com/qa-imagemagick-and-code-organization-in-express-js/">Q&amp;A: ImageMagick and Code Organization in Express.js</a>
						</li>
					<li>
				<a href="http://webapplog.com/goodby-mediatemple-and-hello-wpengine/">Goodby MediaTemple and Hello WPEngine</a>
						</li>
					<li>
				<a href="http://webapplog.com/express-js-fundamentals/">Express.js FUNdamentals: An Essential Overview of Express.js</a>
						</li>
					<li>
				<a href="http://webapplog.com/why-you-should-not-work-at-a-startup/">Why You Should Not Work at a Startup</a>
						</li>
					<li>
				<a href="http://webapplog.com/express-js-guide-foreword-by-anatoliy-chakkaev/">Foreword to Express.js Guide: The Comprehensive Book on Expresss.js</a>
						</li>
					<li>
				<a href="http://webapplog.com/expressworks/">ExpressWorks: an Automated Express.js/Node.js Workshop and Tutorial</a>
						</li>
					<li>
				<a href="http://webapplog.com/qa-thank-you-web-app-express-js-and-emails/">Q&amp;A: Thank You Web App, Express.js and Emails</a>
						</li>
					<li>
				<a href="http://webapplog.com/solving-programming-problems/">Solving Programming Problems</a>
						</li>
					<li>
				<a href="http://webapplog.com/express-js-guide-release/">The Release of Express.js Guide: The Comprehensive Book on Express.js</a>
						</li>
					<li>
				<a href="http://webapplog.com/todo-app-with-express-jsnode-js-and-mongodb/">Todo App with Express.js/Node.js and MongoDB</a>
						</li>
					<li>
				<a href="http://webapplog.com/notes-from-startup-school-2013-by-ycombinator/">Notes from Startup School 2013 by YCombinator</a>
						</li>
					<li>
				<a href="http://webapplog.com/javascript-allonge-and-rapid-prototyping-with-js/">JavaScript Allongé and Rapid Prototyping with JS</a>
						</li>
					<li>
				<a href="http://webapplog.com/nodeframework-com-5-new-node-js-frameworks-and-express-js-todo-app/">NodeFramework.com: 5 New Node.js Frameworks and Express.js Todo app</a>
						</li>
					<li>
				<a href="http://webapplog.com/js-fundamentals/">JS FUNdamentals: An Essential Overview of JavaScript</a>
						</li>
					<li>
				<a href="http://webapplog.com/my-first-week-at-docusign/">My First Week at DocuSign</a>
						</li>
					<li>
				<a href="http://webapplog.com/express-js-guide-pre-order-tutorials-examples-api-reference-and-tips/">Express.js Guide Pre-Order: Tutorials, Examples, API Reference and Tips</a>
						</li>
					<li>
				<a href="http://webapplog.com/markdown-web-publishing/">Markdown Web Publishing</a>
						</li>
					<li>
				<a href="http://webapplog.com/good-bye-storify/">Good Bye Storify</a>
						</li>
					<li>
				<a href="http://webapplog.com/interview-hacks/">Interview Hacks</a>
						</li>
					<li>
				<a href="http://webapplog.com/php-vs-node-js/">PHP vs. Node.js</a>
						</li>
					<li>
				<a href="http://webapplog.com/web-frameworks-for-node-js/">Web Frameworks for Node.js</a>
						</li>
					<li>
				<a href="http://webapplog.com/startup-life-balance-and-my-mexican-vacation/">Startup Life Balance and My Mexican Vacation</a>
						</li>
					<li>
				<a href="http://webapplog.com/biggest-challenges-before-joining-a-coding-bootcamp/">Biggest Challenges Before Joining a Coding Bootcamp</a>
						</li>
					<li>
				<a href="http://webapplog.com/tutorial-node-js-and-mongodb-json-rest-api-server-with-mongoskin-and-express-js/">Tutorial: Node.js and MongoDB JSON REST API server with Mongoskin and Express.js</a>
						</li>
					<li>
				<a href="http://webapplog.com/you-dropped-150k-on-a-fucking-education/">You Dropped 150k on a Fucking Education?</a>
						</li>
					<li>
				<a href="http://webapplog.com/cisco-node-js-and-other-musings/">Cisco, Node.js and other musings</a>
						</li>
					<li>
				<a href="http://webapplog.com/node-js-frameworks/">Node.js Frameworks</a>
						</li>
					<li>
				<a href="http://webapplog.com/nodeconf-2013/">NodeConf 2013</a>
						</li>
					<li>
				<a href="http://webapplog.com/the-factory-of-good-habits/">The Factory of Good Habits</a>
						</li>
					<li>
				<a href="http://webapplog.com/first-six-months-with-storify/">First Six Months with Storify</a>
						</li>
					<li>
				<a href="http://webapplog.com/not-everything-has-to-be-done-server-side/">Not Everything has to be done Server-side</a>
						</li>
					<li>
				<a href="http://webapplog.com/nobody-will-train-you-but-you/">Nobody will Train You but You</a>
						</li>
					<li>
				<a href="http://webapplog.com/express-js-tutorial-instagram-gallery-example-app-with-storify-api/">Express.js Tutorial: Instagram Gallery Example App with Storify API</a>
						</li>
					<li>
				<a href="http://webapplog.com/ship-code-that-matters/">Ship Code That Matters</a>
						</li>
					<li>
				<a href="http://webapplog.com/leanpub-compilation-and-sanitizing-tool-written-in-node-js/">LeanPub Compilation and Sanitizing Tool Written in Node.js</a>
						</li>
					<li>
				<a href="http://webapplog.com/rapid-prototyping-with-js-agile-javascript-development-is-done-with-v0-5-1-0rc/">Rapid Prototyping with JS: Agile JavaScript Development is done with v0.5 (1.0RC)!</a>
						</li>
					<li>
				<a href="http://webapplog.com/nested-objects-in-mongoose/">Nested Objects in Mongoose</a>
						</li>
					<li>
				<a href="http://webapplog.com/git-reflog-to-rescue-after-hard-resets/">Git Reflog to Rescue after Hard Resets</a>
						</li>
					<li>
				<a href="http://webapplog.com/intro-to-express-js-parameters-error-handling-and-other-middleware/">Intro to Express.js: Parameters, Error Handling and Other Middleware</a>
						</li>
					<li>
				<a href="http://webapplog.com/node-js-mvc-express-js-derby-hello-world-tutorial/">Node.js MVC: Express.js + Derby.js Hello World Tutorial</a>
						</li>
					<li>
				<a href="http://webapplog.com/day-6-of-startupbus-2013-all-star-finals/">Day 6 of StartupBus 2013: All-Star Finals</a>
						</li>
					<li>
				<a href="http://webapplog.com/node-js-oauth1-0-and-oauth2-0-twitter-api-v1-1-examples/">Node.js OAuth1.0 and OAuth2.0: Twitter API v1.1 Examples</a>
						</li>
					<li>
				<a href="http://webapplog.com/startupbus-2013-day-5-finals/">StartupBus 2013 Day 5: Finals</a>
						</li>
					<li>
				<a href="http://webapplog.com/intro-to-express-js-simple-rest-api-app-with-monk-and-mongodb/">Intro to Express.js: Simple REST API app with Monk and MongoDB</a>
						</li>
					<li>
				<a href="http://webapplog.com/paste-and-match-style-on-mac-os-x/">Paste and Match Style on Mac OS X</a>
						</li>
					<li>
				<a href="http://webapplog.com/startupbus-2013-day-4-semi-finals/">StartupBus 2013: Day 4, Semi Finals</a>
						</li>
					<li>
				<a href="http://webapplog.com/rapid-prototyping-with-js-v04/">Rapid Prototyping with JS Update v0.4</a>
						</li>
					<li>
				<a href="http://webapplog.com/test-driven-development-in-node-js-with-mocha/">Test-Driven Development in Node.js With Mocha</a>
						</li>
					<li>
				<a href="http://webapplog.com/asynchronicity-in-node-js/">Asynchronicity in Node.js</a>
						</li>
					<li>
				<a href="http://webapplog.com/startupbus-day-3-texas/">Startupbus Day 3: Texas</a>
						</li>
					<li>
				<a href="http://webapplog.com/startupbus-day-2-arizona/">StartupBus Day 2: Arizona</a>
						</li>
					<li>
				<a href="http://webapplog.com/startupbus-day-1/">StartupBus Day 1</a>
						</li>
					<li>
				<a href="http://webapplog.com/startup-bus-is-not-a-joke/">Startup Bus is Not a Joke</a>
						</li>
					<li>
				<a href="http://webapplog.com/home-and-end-shortcuts-in-terminal/">Home and End Shortcuts in Terminal</a>
						</li>
					<li>
				<a href="http://webapplog.com/cheat-sheets-for-web-development/">Cheat Sheets for Web Development</a>
						</li>
					<li>
				<a href="http://webapplog.com/android-to-ios-or-why-guy-kawasaki-is-wrong/">Android to iOS or Why Guy Kawasaki Is Wrong</a>
						</li>
					<li>
				<a href="http://webapplog.com/switching-from-windows-to-max-os-x/">Switching from Windows to Max OS X</a>
						</li>
					<li>
				<a href="http://webapplog.com/decreasing-64-bit-tweet-id-in-javascript/">Decreasing 64-bit Tweet ID in JavaScript</a>
						</li>
					<li>
				<a href="http://webapplog.com/mongodb-migration-with-node-and-monk/">MongoDB migration with Node and Monk</a>
						</li>
					<li>
				<a href="http://webapplog.com/sample-of-rapid-prototyping-with-js/">Sample of Rapid Prototyping with JS</a>
						</li>
					<li>
				<a href="http://webapplog.com/my-social-media-policies/">My Social Media Policies</a>
						</li>
					<li>
				<a href="http://webapplog.com/wintersmith-node-js-static-site-generator/">Wintersmith — Node.js static site generator</a>
						</li>
					<li>
				<a href="http://webapplog.com/querying-20m-record-mongodb-collection/">Querying 20M-Record MongoDB Collection</a>
						</li>
					<li>
				<a href="http://webapplog.com/call-for-reviewers-and-a-free-copy-of-rapid-prototyping-with-js/">Call for Reviewers and a Free Copy of Rapid Prototyping with JS</a>
						</li>
					<li>
				<a href="http://webapplog.com/my-first-week-at-storify/">My First Week At Storify</a>
						</li>
					<li>
				<a href="http://webapplog.com/rapid-prototyping-with-js-is-out/">Rapid Prototyping with JS is out!</a>
						</li>
					<li>
				<a href="http://webapplog.com/markdown-goodness/">Markdown Goodness</a>
						</li>
					<li>
				<a href="http://webapplog.com/most-common-technical-questions-for-early-stage-startups/">Most Common Technical Questions for Early-Stage Startups</a>
						</li>
					<li>
				<a href="http://webapplog.com/launchrock-vs-kickofflabs/">LaunchRock vs KickoffLabs</a>
						</li>
					<li>
				<a href="http://webapplog.com/what-weve-learned-from-teaching-the-trainings/">What We’ve Learned From Teaching the Trainings</a>
						</li>
					<li>
				<a href="http://webapplog.com/what-is-accelerator-io/">What is Accelerator.IO?</a>
						</li>
					<li>
				<a href="http://webapplog.com/online-education-overview/">Online Education Overview</a>
						</li>
					<li>
				<a href="http://webapplog.com/how-to-decrease-chances-of-success-in-a-startup/">How to Decrease Chances of Success in a Startup</a>
						</li>
					<li>
				<a href="http://webapplog.com/help-to-build-new-social-network-for-entrepreneurs-accelerator-io/">Help to build new social network for entrepreneurs –  Accelerator.IO</a>
						</li>
					<li>
				<a href="http://webapplog.com/openlist-co-ad-classified-website-application/">openList.co – Ad Classified Website Application</a>
						</li>
					<li>
				<a href="http://webapplog.com/deployment-of-static-files-to-heroku/">Deployment of Static Files to Heroku</a>
						</li>
					<li>
				<a href="http://webapplog.com/pilot-rapid-prototyping-with-javascript-and-nodejs-class/">Pilot Rapid Prototyping with JavaScript and NodeJS Class</a>
						</li>
					<li>
				<a href="http://webapplog.com/highlights-from-hackers-painters-by-paul-graham/">Highlights from “Hackers &amp; Painters” by Paul Graham</a>
						</li>
					<li>
				<a href="http://webapplog.com/i-will-puke-if-i-hear-array-search-interview-question-again/">I will puke if I hear array search interview question again</a>
						</li>
				</ul>
		</aside>		</div><!-- #secondary -->
	  </div><!-- #main .wrapper -->
  <footer id="colophon" role="contentinfo">
    <div class="site-info">
      <p class="text-center">Webapplog © 2013 <a href="http://azat.co/">Azat Mardanov</a>. All rights reserved.</p>
   <!--          <a href="http://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress</a> -->
    </div><!-- .site-info -->
  </footer><!-- #colophon -->
</div><script id="pocket-btn-js" src="./Express.js and Mongoose Example  Building HackHall_files/btn.js"></script><!-- #page -->




<!-- HitTail Code -->
<script type="text/javascript">
	(function(){ var ht = document.createElement('script');ht.async = true;
	  ht.type='text/javascript';ht.src = '//107452.hittail.com/mlt.js';
	  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ht, s);})();
</script><script type="text/javascript">
/* <![CDATA[ */
var _wpcf7 = {"loaderUrl":"http:\/\/webapplog.com\/wp-content\/plugins\/contact-form-7\/images\/ajax-loader.gif","sending":"Sending ...","cached":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/scripts.js"></script>
<script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/stacktack.min.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var stacktack = {"answers":"accepted","tags":"true","secure":"false"};
/* ]]> */
</script>
<script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/stacktack.init.js"></script>
<script type="text/javascript" src="./Express.js and Mongoose Example  Building HackHall_files/navigation.js"></script>
<!--Begin Real Time on Site and Bounce Rate -->
<script>
var _gaq = _gaq || [];
(function (tos) {
  window.setInterval(function () {
    tos = (function (t) {
      return t[0] == 50 ? (parseInt(t[1]) + 1) + ':00' : (t[1] || '0') + ':' + (parseInt(t[0]) + 10);
    })(tos.split(':').reverse());
    window.pageTracker ? pageTracker._trackEvent('Time', 'Log', tos) : _gaq.push(['_trackEvent', 'Time', 'Log', tos]);
  }, 10000);
})('00');
</script>
<!--End Real Time on Site and Bounce Rate -->

<div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe name="fb_xdm_frame_http" frameborder="0" allowtransparency="true" scrolling="no" id="fb_xdm_frame_http" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tab-index="-1" src="./Express.js and Mongoose Example  Building HackHall_files/wTH8U0osOYl.html" style="border: none;"></iframe><iframe name="fb_xdm_frame_https" frameborder="0" allowtransparency="true" scrolling="no" id="fb_xdm_frame_https" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tab-index="-1" src="./Express.js and Mongoose Example  Building HackHall_files/wTH8U0osOYl(1).html" style="border: none;"></iframe></div></div></div><iframe name="oauth2relay559947891" id="oauth2relay559947891" src="./Express.js and Mongoose Example  Building HackHall_files/postmessageRelay.html" tabindex="-1" style="width: 1px; height: 1px; position: absolute; top: -100px;"></iframe></body></html>